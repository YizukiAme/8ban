<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«è´¤æ¸¡Â·æ•¬ä¸šèˆŸ</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- å¼•å…¥ Marked.js ç”¨äº Markdown æ¸²æŸ“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #2d3748;
            overflow-x: hidden;
        }

        .glassmorphism {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 28px 0 rgba(31, 38, 135, 0.2);
        }

        /* Enhanced hover effect for specific cards */
        .enhanced-card-hover {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .enhanced-card-hover:hover {
            transform: scale(1.03) translateY(-3px);
            box-shadow: 0 15px 30px -5px rgba(59, 130, 246, 0.25), 0 8px 10px -6px rgba(59, 130, 246, 0.2); /* Blue glow */
        }

        .highlight-text {
            position: relative;
            display: inline-block;
        }

        .highlight-text::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background-color: rgba(99, 102, 241, 0.2);
            z-index: -1;
        }

        .mobile-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            padding: 1rem;
            margin: 0.5rem;
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            transform-origin: top;
            transform: scaleY(0);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 100;
        }

        .mobile-menu.active {
            transform: scaleY(1);
            opacity: 1;
        }

        /* Tool area reveal animation */
        .tools-grid-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.7s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.5s ease-out, transform 0.5s ease-out;
            opacity: 0;
            transform: translateY(20px);
        }

        .tools-grid-container.active {
            max-height: 2000px; /* Adjust if needed for more tools */
            opacity: 1;
            transform: translateY(0);
        }

        /* Chat bubble styles */
        .chat-bubble {
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
            max-width: 75%;
            word-wrap: break-word;
        }
        .chat-bubble-user {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 0.25rem;
        }
        .chat-bubble-ai {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
            margin-right: auto;
            border-bottom-left-radius: 0.25rem;
        }
        /* Markdown æ¸²æŸ“åçš„æ ·å¼ä¼˜åŒ– */
        .chat-bubble-ai p:first-child { margin-top: 0; }
        .chat-bubble-ai p:last-child { margin-bottom: 0; }
        .chat-bubble-ai pre {
            background-color: #2d3748; /* Dark background for code blocks */
            color: #e2e8f0; /* Light text color */
            padding: 0.75rem;
            border-radius: 0.5rem;
            overflow-x: auto; /* Enable horizontal scrolling for long code lines */
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.875rem; /* text-sm */
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            line-height: 1.5; /* improve readability of code */
        }
        .chat-bubble-ai code {
            background-color: #cbd5e0; /* lighter gray for inline code */
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-size: 0.875em;
        }
        .chat-bubble-ai ul, .chat-bubble-ai ol {
            margin-left: 1.25rem; /* space-x-5 for lists */
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            list-style-type: disc; /* default for ul */
        }
        .chat-bubble-ai ol {
            list-style-type: decimal;
        }


        #chatMessages {
            scroll-behavior: smooth;
        }

        /* Danmaku animation */
        @keyframes moveRight {
            0% { transform: translateX(-100%); opacity: 1;}
            90% { opacity: 1; }
            100% { transform: translateX(100vw); opacity: 0; }
        }
        .danmaku-item {
            position: absolute;
            white-space: nowrap;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 5px;
            background-color: rgba(0,0,0,0.1); /* Slight background for readability */
        }

        /* Timeline dot improvement */
        .timeline-dot {
            width: 12px;
            height: 12px;
            background-color: #60a5fa; /* blue-400 */
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 0 3px #60a5fa;
        }

        /* Modal Chatbot Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            backdrop-filter: blur(8px); /* Blur background */
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .modal.open {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            position: relative;
            width: 90%;
            max-width: 960px; /* Max width for larger screens */
            height: 90%;
            max-height: 700px; /* Max height for larger screens */
            display: flex;
            flex-direction: column;
            transform: translateY(20px);
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .modal.open .modal-content {
            transform: translateY(0);
            opacity: 1;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            color: #aaa;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close:hover,
        .modal-close:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            background-color: #f8fafc;
        }
        .modal-chat-input-area {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding-top: 0.5rem;
        }

        /* Danmaku Records Specific Styles */
        .danmaku-record-item {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        .danmaku-record-item p {
            margin: 0;
            line-height: 1.4;
        }
        .danmaku-record-item .info {
            font-size: 0.75rem; /* text-xs */
            color: #64748b; /* slate-500 */
            margin-top: 0.5rem;
            text-align: right;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- å¯¼èˆªæ¡ -->
    <nav class="glassmorphism sticky top-0 z-50 p-4 mb-8" id="mainNav">
        <div class="container mx-auto flex items-center justify-between">
            <div class="text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 text-transparent bg-clip-text">
                <i class="fas fa-book mr-2"></i>å…«è´¤æ¸¡Â·æ•¬ä¸šèˆŸ - 202508 æ°¸ä¹…çºªå¿µé¡µ
            </div>
            <div class="hidden md:flex space-x-6">
                <a href="#home" class="text-gray-600 hover:text-blue-600 transition-colors">é¦–é¡µ</a>
                <a href="#memory-area" class="text-gray-600 hover:text-blue-600 transition-colors">å›å¿†</a>
                <a href="#tool-area" class="text-gray-600 hover:text-blue-600 transition-colors">å·¥å…·</a>
                <a href="#chatbot-area" class="text-gray-600 hover:text-blue-600 transition-colors">Chat with å°å…«</a>
                <a href="#message-area" class="text-gray-600 hover:text-blue-600 transition-colors">ç•™è¨€</a>
            </div>
            <button class="md:hidden text-gray-600 focus:outline-none" id="mobileMenuButton" aria-label="å¯¼èˆªèœå•">
                <i class="fas fa-bars text-xl"></i>
            </button>

            <div class="mobile-menu md:hidden" id="mobileMenu">
                <a href="#home" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-home mr-3 text-blue-500 w-5 text-center"></i>é¦–é¡µ</a>
                <a href="#memory-area" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-images mr-3 text-blue-500 w-5 text-center"></i>å›å¿†åŒº</a>
                <a href="#tool-area" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-tools mr-3 text-blue-500 w-5 text-center"></i>å·¥å…·åŒº</a>
                <a href="#chatbot-area" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-robot mr-3 text-blue-500 w-5 text-center"></i>Chat with å°å…«</a>
                <a href="#message-area" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-comment-dots mr-3 text-blue-500 w-5 text-center"></i>ç•™è¨€åŒº</a>
            </div>
        </div>
    </nav>

    <!-- é¦–é¡µ -->
    <section id="home" class="container mx-auto py-16 px-4 md:px-8 relative">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-6">
                <span class="highlight-text">å…«è´¤æ¸¡Â·æ•¬ä¸šèˆŸ</span>
            </h1>
            <p class="text-xl md:text-2xl text-gray-700 mb-8">ä»æ­¤å²¸åˆ°å½¼å²¸ï¼Œå…«ç­é£é‡‡ä¾æ—§</p>
            <div class="flex flex-wrap justify-center gap-4">
                <a href="#memory-area" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors text-lg font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <i class="fas fa-images mr-2"></i>å›å¿†åŒº
                </a>
                <a href="#tool-area" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg transition-colors text-lg font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <i class="fas fa-tools mr-2"></i>å·¥å…·åŒº
                </a>
                <a href="#chatbot-area" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors text-lg font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <i class="fas fa-robot mr-2"></i>Chat with å°å…«
                </a>
                <a href="#message-area" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg transition-colors text-lg font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <i class="fas fa-comment-dots mr-2"></i>ç•™è¨€åŒº
                </a>
            </div>
        </div>
    </section>

    <!-- å›å¿†åŒº -->
    <section id="memory-area" class="container mx-auto py-12 px-4 md:px-8">
        <div class="glassmorphism p-6 md:p-8 mb-16">
            <h2 class="text-3xl font-bold mb-8 flex items-center text-gray-800">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white mr-4 shadow-lg">
                    <i class="fas fa-images text-xl"></i>
                </div>
                å›å¿†åŒº
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div>
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">Timeline</h3>
                    <div class="space-y-6 relative pl-5 border-l-2 border-blue-200">
                        <div class="flex items-start relative">
                            <div class="timeline-dot absolute -left-[29px] top-1"></div>
                            <div class="ml-4 p-4 bg-white/70 rounded-lg shadow-sm w-full">
                                <h4 class="font-medium text-blue-600">2022å¹´9æœˆ</h4>
                                <p class="text-gray-600 text-sm">å…¥å­¦ç¬¬ä¸€å¤©ï¼Œé’æ¶©çš„æˆ‘ä»¬ï¼Œæ€€æ£æ¢¦æƒ³ï¼Œç›¸èšäºæ­¤ã€‚</p>
                            </div>
                        </div>
                        <div class="flex items-start relative">
                            <div class="timeline-dot absolute -left-[29px] top-1"></div>
                            <div class="ml-4 p-4 bg-white/70 rounded-lg shadow-sm w-full">
                                <h4 class="font-medium text-blue-600">2024å¹´3æœˆ</h4>
                                <p class="text-gray-600 text-sm">æ˜¥å­£è¿åŠ¨ä¼šï¼Œèµ›åœºä¸Šçš„æ±—æ°´ï¼Œæ˜¯æˆ‘ä»¬æ‹¼æçš„è§è¯ã€‚</p>
                            </div>
                        </div>
                        <div class="flex items-start relative">
                            <div class="timeline-dot absolute -left-[29px] top-1"></div>
                            <div class="ml-4 p-4 bg-white/70 rounded-lg shadow-sm w-full">
                                <h4 class="font-medium text-blue-600">2025å¹´6æœˆ</h4>
                                <p class="text-gray-600 text-sm">æ¯•ä¸šå…¸ç¤¼ï¼ŒéªŠæ­Œå“èµ·ï¼Œæˆ‘ä»¬å³å°†å¥”èµ´å„è‡ªçš„æ˜Ÿè¾°å¤§æµ·ã€‚</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">ç›¸å†Œç”»å»Šï¼ˆå ä½å›¾ç‰‡ingï¼‰</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                        <!-- å ä½å›¾ç‰‡ï¼Œè¯·æ›¿æ¢ä¸ºå®é™…å›¾ç‰‡ -->
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=1" alt="ç­çº§æ´»åŠ¨ç…§ç‰‡ 1" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=2" alt="ç­çº§æ´»åŠ¨ç…§ç‰‡ 2" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=3" alt="ç­çº§æ´»åŠ¨ç…§ç‰‡ 3" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=4" alt="ç­çº§æ´»åŠ¨ç…§ç‰‡ 4" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=5" alt="ç­çº§æ´»åŠ¨ç…§ç‰‡ 5" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=6" alt="ç­çº§æ´»åŠ¨ç…§ç‰‡ 6" class="w-full h-full object-cover">
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">æ¯•ä¸šè§†é¢‘ï¼ˆå ä½ingï¼‰</h3>
                <div class="bg-black rounded-lg aspect-video flex items-center justify-center relative overflow-hidden shadow-xl">
                    <img src="https://source.unsplash.com/random/800x450?graduation,celebration" alt="æ¯•ä¸šè§†é¢‘å°é¢" class="absolute inset-0 w-full h-full object-cover opacity-70">
                    <i class="fas fa-play-circle text-6xl text-white opacity-80 z-10 cursor-pointer hover:opacity-100 transition-opacity"></i>
                    <!-- å®é™…è§†é¢‘åµŒå…¥å ä½: <video controls class="w-full h-full"><source src="your-video.mp4" type="video/mp4"></video> -->
                </div>
            </div>

            <div>
                <h3 class="text-xl font-semibold mb-4 text-gray-700">å¯„è¯­å¡ç‰‡å¢™</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-100 p-5 rounded-xl shadow-lg card-hover">
                        <p class="text-gray-700 text-sm leading-relaxed">"ä¸è¦å¤©å¤©ä½œä¸šå¸®ã€‚"</p>
                        <p class="text-right text-xs text-indigo-500 mt-2">- è‘£è€å¸ˆ</p>
                    </div>
                    <div class="bg-gradient-to-br from-green-50 to-teal-100 p-5 rounded-xl shadow-lg card-hover">
                        <p class="text-gray-700 text-sm leading-relaxed">"é«˜ä¸­ç”Ÿæ´»è™½ç„¶ç»“æŸäº†ï¼Œä½†æ˜¯æ‚¨çš„æœªæ¥è¿˜æœ‰å¾ˆå¤šç¾å¥½çš„äº‹æƒ…ç­‰å¾…ç€æ‚¨ï¼ŒåŠ æ²¹å–µï¼"</p>
                        <p class="text-right text-xs text-teal-500 mt-2">- æœ±è€å¸ˆ</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-pink-100 p-5 rounded-xl shadow-lg card-hover">
                        <p class="text-gray-700 text-sm leading-relaxed">"ç­é‡Œç”·ç”Ÿå®‰é™ä¸€ç‚¹ğŸ˜¡ğŸ˜¡ğŸ˜­"</p>
                        <p class="text-right text-xs text-pink-500 mt-2">- è¯¸è€å¸ˆ</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- å·¥å…·åŒº -->
    <section id="tool-area" class="container mx-auto py-12 px-4 md:px-8">
        <div class="glassmorphism p-6 md:p-8 mb-16">
            <h2 class="text-3xl font-bold mb-8 flex items-center text-gray-800">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-teal-600 flex items-center justify-center text-white mr-4 shadow-lg">
                    <i class="fas fa-tools text-xl"></i>
                </div>
                å·¥å…·åŒº
            </h2>

            <!-- å­¦æœ¯åŠ©æ‰‹ä¸»å¡ç‰‡ -->
            <div id="academicHelperCard" class="bg-gradient-to-br from-indigo-500 to-purple-600 p-6 rounded-xl shadow-xl cursor-pointer enhanced-card-hover mb-6 text-white flex items-center justify-between">
                <div>
                    <h3 class="text-2xl font-semibold mb-2 flex items-center">
                        <i class="fas fa-graduation-cap mr-3"></i>å­¦æœ¯åŠ©æ‰‹
                    </h3>
                    <p class="text-indigo-100">ä¸ºä½ çš„å­¦ä¹ å’Œç ”ç©¶æä¾›å¼ºå¤§æ”¯æŒâ€”â€”ç‚¹å‡»å±•å¼€å®ç”¨å·¥å…·é›†ã€‚</p>
                </div>
                <i id="toolsToggleIcon" class="fas fa-chevron-down text-2xl transition-transform duration-300"></i>
            </div>

            <!-- å·¥å…·å¡ç‰‡ç½‘æ ¼ (Bento Grid style, initially hidden) -->
            <div id="toolsGridContainer" class="tools-grid-container">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="toolsGrid">
                    <!-- Tool cards will be injected here by JavaScript -->
                </div>
            </div>

            <!-- ä¼‘é—²åŠ©æ‰‹ä¸»å¡ç‰‡ -->
            <div id="academicHelperCard" class="bg-gradient-to-br from-indigo-500 to-purple-600 p-6 rounded-xl shadow-xl cursor-pointer enhanced-card-hover mb-6 text-white flex items-center justify-between">
                <div>
                    <h3 class="text-2xl font-semibold mb-2 flex items-center">
                        <i class="fas fa-graduation-cap mr-3"></i>ä¼‘é—²åŠ©æ‰‹
                    </h3>
                    <p class="text-indigo-100">ä¸ºä½ çš„è¯¾ä¸šé—²æš‡æ·»ç‚¹è¶£å‘³â€”â€”ç‚¹å‡»å±•å¼€ä¼‘é—²å·¥å…·é›†ã€‚</p>
                </div>
                <i id="toolsToggleIcon" class="fas fa-chevron-down text-2xl transition-transform duration-300"></i>
            </div>

            <!-- å·¥å…·å¡ç‰‡ç½‘æ ¼ (Bento Grid style, initially hidden) -->
            <div id="toolsGridContainer" class="tools-grid-container">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="toolsGrid">
                    <!-- Tool cards will be injected here by JavaScript -->
                </div>
            </div>
        </div>
    </section>

    <!-- Chat with å°å…«åŒº -->
    <section id="chatbot-area" class="container mx-auto py-12 px-4 md:px-8">
        <div class="glassmorphism p-6 md:p-8 mb-16">
            <h2 class="text-3xl font-bold mb-8 flex items-center text-gray-800">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-pink-500 to-rose-600 flex items-center justify-center text-white mr-4 shadow-lg">
                    <i class="fas fa-robot text-xl"></i>
                </div>
                Chat with å°å…«
                <button id="openChatModalButton" class="ml-auto bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded-lg transition-colors shadow-md hover:shadow-lg">
                    <i class="fas fa-expand mr-2"></i>å±•å¼€å¯¹è¯
                </button>
            </h2>

            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 sm:p-6 max-w-3xl mx-auto shadow-lg border border-gray-200">
                <div id="chatMessages" class="h-80 overflow-y-auto mb-4 p-3 space-y-3 bg-gray-50/50 rounded-lg border">
                    <!-- Messages will be appended here by JS -->
                </div>

                <div class="flex items-center gap-3">
                    <input type="text" id="chatInput" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..." class="flex-1 border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm text-sm">
                    <button id="chatSendButton" class="bg-blue-500 hover:bg-blue-600 text-white px-5 py-3 rounded-lg transition-colors shadow-md hover:shadow-lg transform hover:-translate-y-0.5 flex items-center">
                        <i class="fas fa-paper-plane mr-2 sm:mr-0"></i><span class="hidden sm:inline">å‘é€</span>
                    </button>
                </div>
                <p id="chatError" class="text-red-500 text-xs mt-2 h-4"></p>
            </div>
        </div>
    </section>

    <!-- å¼¹å‡ºçš„æ¨¡æ€å¯¹è¯æ¡† (å…¨å±æ¨¡æ‹Ÿ) -->
    <div id="chatModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" id="closeChatModalButton">Ã—</span>
            <h3 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-robot mr-2"></i>å°å…«
                <select id="modelSelect" class="ml-4 text-base px-3 py-1 rounded-lg bg-gray-100 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <!-- æ–°çš„æ¨¡å‹é€‰é¡¹ -->
                    <option value="domestic_normal">æ™®é€šå°å…« (å›½å†…ç‰ˆ)</option>
                    <option value="domestic_inference">æ¨ç†å°å…« (å›½å†…ç‰ˆ)</option>
                    <option value="international_normal">æ™®é€šå°å…« (å›½é™…ç‰ˆ)</option>
                    <option value="international_inference">æ¨ç†å°å…« (å›½é™…ç‰ˆ)</option>
                </select>
                <span id="currentModelDisplay" class="ml-2 text-sm text-gray-600">å½“å‰æ¨¡å‹: æ™®é€šå°å…« (å›½å†…ç‰ˆ)</span>
            </h3>
            <div id="modalChatMessages" class="modal-chat-messages space-y-3">
                <!-- Messages will be cloned/appended here -->
            </div>
            <div class="modal-chat-input-area">
                <input type="text" id="modalChatInput" placeholder="è¾“å…¥ä½ çš„é—®é¢˜..." class="flex-1 border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm text-sm">
                <button id="modalChatSendButton" class="bg-blue-500 hover:bg-blue-600 text-white px-5 py-3 rounded-lg transition-colors shadow-md flex items-center">
                    <i class="fas fa-paper-plane mr-2 sm:mr-0"></i><span class="hidden sm:inline">å‘é€</span>
                </button>
                <button id="downloadChatButton" class="bg-indigo-500 hover:bg-indigo-600 text-white px-5 py-3 rounded-lg transition-colors shadow-md flex items-center">
                    <i class="fas fa-download mr-2"></i><span class="hidden sm:inline">ä¸‹è½½å¯¹è¯</span>
                </button>
            </div>
            <p id="modalChatError" class="text-red-500 text-xs mt-2 h-4"></p>
        </div>
    </div>

    <!-- ç•™è¨€åŒº (ä»…ä¿ç•™å¼¹å¹•åŒº) -->
    <section id="message-area" class="container mx-auto py-12 px-4 md:px-8">
        <div class="glassmorphism p-6 md:p-8 mb-16">
            <h2 class="text-3xl font-bold mb-8 flex items-center text-gray-800">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-orange-500 to-amber-600 flex items-center justify-center text-white mr-4 shadow-lg">
                    <i class="fas fa-comment-dots text-xl"></i>
                </div>
                ç•™è¨€åŒº
            </h2>

            <!-- å®æ—¶å¼¹å¹•åŒº -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">å®æ—¶å¼¹å¹•</h3>
                <div id="danmakuContainer" class="bg-gray-800/80 backdrop-blur-sm rounded-lg h-72 p-4 overflow-hidden relative shadow-inner border border-gray-700">
                    <!-- Dynamic danmaku items will be loaded here -->
                </div>

                <div class="mt-4 flex items-center gap-3">
                    <input type="text" id="danmakuInput" placeholder="è¾“å…¥ä½ çš„å¼¹å¹•..." class="flex-1 border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 shadow-sm text-sm">
                    <button id="danmakuSendButton" class="bg-orange-500 hover:bg-orange-600 text-white px-5 py-3 rounded-lg transition-colors shadow-md hover:shadow-lg transform hover:-translate-y-0.5 flex items-center">
                        <i class="fas fa-paper-plane mr-2 sm:mr-0"></i><span class="hidden sm:inline">å‘é€</span>
                    </button>
                </div>
            </div>

            <!-- å¼¹å¹•å†å²è®°å½•åŒº -->
            <div>
                <h3 class="text-xl font-semibold mb-4 text-gray-700">å¼¹å¹•å†å²è®°å½•</h3>
                <div id="danmakuRecords" class="space-y-3 max-h-96 overflow-y-auto p-2 bg-gray-50/50 rounded-lg border border-gray-200">
                    <!-- Historical danmaku items will be loaded here -->
                    <p class="text-gray-500 text-sm text-center">åŠ è½½ä¸­...</p>
                </div>
                <p id="danmakuRecordsError" class="text-red-500 text-xs mt-2 h-4"></p>
            </div>
        </div>
    </section>

    <!-- é¡µè„š -->
    <footer class="bg-gray-100/70 py-8 mt-10 border-t border-gray-200/80">
        <div class="container mx-auto px-4 md:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left">
                <div class="mb-4 md:mb-0">
                    <p class="text-gray-600 text-sm">Â© å…«è´¤æ¸¡Â·æ•¬ä¸šèˆŸ - 202508 æ°¸ä¹…çºªå¿µé¡µ</p>
                    <p class="text-gray-500 text-xs mt-1">äººç”Ÿæœ‰æ¢¦ï¼Œä¸€èµ·åšæ¢¦ã€‚</p>
                </div>
                <div class="flex items-center">
                    <p class="text-gray-600 text-sm mr-4">Designed by <a href="https://github.com/YizukiAme" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:text-blue-700 hover:underline">Yizuki_Ame</a></p>
                    <!-- <div class="bg-white p-2 rounded-lg shadow">
                        <div class="w-20 h-20 bg-gray-200 flex items-center justify-center text-gray-400 text-xs">ç­å¾½/äºŒç»´ç </div>
                    </div> -->
                </div>
            </div>
        </div>
    </footer>

    <script>
        // -----------------------------------------------------------------------------
        // ç§»åŠ¨ç«¯å¯¼èˆªèœå•åˆ‡æ¢ (Existing)
        // -----------------------------------------------------------------------------
        document.addEventListener('DOMContentLoaded', function() {
            const menuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');

            menuButton.addEventListener('click', function() {
                mobileMenu.classList.toggle('active');
                const icon = this.querySelector('i');
                if (mobileMenu.classList.contains('active')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });

            // å¹³æ»‘æ»šåŠ¨ (Existing)
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetElement = document.querySelector(this.getAttribute('href'));
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                    // ç‚¹å‡»å¯¼èˆªé“¾æ¥åå…³é—­ç§»åŠ¨ç«¯èœå•
                    if (mobileMenu.classList.contains('active')) {
                        mobileMenu.classList.remove('active');
                        const icon = menuButton.querySelector('i');
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });
            });
        });

        // -----------------------------------------------------------------------------
        // å·¥å…·åŒºåŠŸèƒ½ (Tool Area Functionality - NEW)
        // -----------------------------------------------------------------------------
        document.addEventListener('DOMContentLoaded', function() {
            const academicHelperCard = document.getElementById('academicHelperCard');
            const toolsGridContainer = document.getElementById('toolsGridContainer');
            const toolsToggleIcon = document.getElementById('toolsToggleIcon');
            const toolsGrid = document.getElementById('toolsGrid');

            const toolsData = [
                { name: 'DeepSeek', description: 'å…è´¹ AI å†™ä½œè¾…åŠ©å·¥å…·', link: 'https://www.deepseek.com/', icon: 'fas fa-search-plus' },
                { name: 'SurveyGO', description: 'æ¸…å NLP ç»„ AI é—®å·ç”Ÿæˆå™¨', link: 'https://surveygo.modelbest.cn/', icon: 'fas fa-poll-h' },
                { name: 'Mendeley', description: 'å­¦æœ¯å‚è€ƒæ–‡çŒ®ç®¡ç†å·¥å…·', link: 'https://www.mendeley.com/', icon: 'fas fa-book-reader' },
                { name: 'Notion', description: 'äº‘ç¬”è®°+çŸ¥è¯†ç®¡ç†å¹³å°', link: 'https://www.notion.so/', icon: 'fas fa-sticky-note' },
                { name: 'uTools', description: 'ç”Ÿäº§åŠ›æ¡Œé¢æ’ä»¶å¹³å°', link: 'https://www.u.tools/', icon: 'fas fa-puzzle-piece' },
                { name: 'Sci-Hub å¤‡ç”¨', description: 'å…è´¹è·å–ç§‘ç ”æ–‡çŒ® (å‚è€ƒ)', link: 'https://sci-hub.se/', icon: 'fas fa-key' },
                { name: 'arXiv', description: 'å¼€æºè®ºæ–‡é¢„å°æœ¬å¹³å°', link: 'https://arxiv.org/', icon: 'fas fa-atom' },
                { name: 'Zotero', description: 'æ–‡çŒ®ç®¡ç†å™¨ (å­¦æœ¯é€‚ç”¨)', link: 'https://www.zotero.org/', icon: 'fas fa-bookmark' },
                { name: 'OpenRouter', description: 'å…è´¹å¤šæ¨¡å‹è°ƒç”¨å¹³å°', link: 'https://openrouter.ai/', icon: 'fas fa-cogs' },
                { name: 'Hugging Face', description: 'AIæ¨¡å‹ä¸æ•°æ®é›†å¼€æ”¾å¹³å°', link: 'https://huggingface.co/', icon: 'fas fa-brain' }
            ];

            // Function to create and append tool cards
            function populateToolsGrid() {
                toolsGrid.innerHTML = ''; // Clear existing tools if any
                toolsData.forEach(tool => {
                    const cardHtml = `
                        <div class="bg-white/70 backdrop-blur-sm p-5 rounded-xl shadow-lg enhanced-card-hover border border-gray-200/80 flex flex-col justify-between">
                            <div>
                                <div class="flex items-center mb-3">
                                    <i class="${tool.icon} text-2xl text-indigo-500 mr-3 w-8 text-center"></i>
                                    <h4 class="text-lg font-semibold text-gray-800">${tool.name}</h4>
                                </div>
                                <p class="text-gray-600 text-xs leading-relaxed mb-4 h-16">${tool.description}</p>
                            </div>
                            <a href="${tool.link}" target="_blank" rel="noopener noreferrer"
                               class="mt-auto block w-full bg-indigo-500 hover:bg-indigo-600 text-white text-center text-sm font-medium py-2 px-4 rounded-lg transition-colors duration-200 shadow hover:shadow-md">
                                å‰å¾€ä½¿ç”¨ <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                            </a>
                        </div>
                    `;
                    toolsGrid.innerHTML += cardHtml; // Directly append HTML string
                });
            }

            if (academicHelperCard && toolsGridContainer && toolsToggleIcon && toolsGrid) {
                populateToolsGrid(); // Populate tools on load

                academicHelperCard.addEventListener('click', () => {
                    toolsGridContainer.classList.toggle('active');
                    toolsToggleIcon.classList.toggle('fa-chevron-down');
                    toolsToggleIcon.classList.toggle('fa-chevron-up');
                    // Optional: Scroll to the tools grid if it's opened and off-screen
                    if (toolsGridContainer.classList.contains('active')) {
                        // A slight delay for the animation to start
                        setTimeout(() => {
                           // toolsGridContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        }, 100);
                    }
                });
            } else {
                console.error("Tool area elements not found.");
            }
        });


        // -----------------------------------------------------------------------------
        // Chat with å°å…« åŠŸèƒ½ (Chat with å°å…« Functionality - NEW)
        // -----------------------------------------------------------------------------
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chatMessages'); // å°çª—å£
            const chatInput = document.getElementById('chatInput');
            const chatSendButton = document.getElementById('chatSendButton');
            const chatError = document.getElementById('chatError');

            const openChatModalButton = document.getElementById('openChatModalButton'); // å±•å¼€æŒ‰é’®
            const chatModal = document.getElementById('chatModal'); // æ¨¡æ€æ¡†
            const closeChatModalButton = document.getElementById('closeChatModalButton'); // å…³é—­æŒ‰é’®
            const modalChatMessages = document.getElementById('modalChatMessages'); // æ¨¡æ€æ¡†å†…çš„èŠå¤©åŒº
            const modalChatInput = document.getElementById('modalChatInput');
            const modalChatSendButton = document.getElementById('modalChatSendButton');
            const modalChatError = document.getElementById('modalChatError');
            const downloadChatButton = document.getElementById('downloadChatButton'); // ä¸‹è½½æŒ‰é’®
            const modelSelect = document.getElementById('modelSelect'); // æ¨¡å‹é€‰æ‹©ä¸‹æ‹‰èœå•
            const currentModelDisplay = document.getElementById('currentModelDisplay'); // å½“å‰æ¨¡å‹æ˜¾ç¤º


            // IMPORTANT: API Key Management
            // è¯·æ›¿æ¢ä¸ºä½ çš„çœŸå® API Keyï¼Œè¿™äº› Key åŠ¡å¿…å¦¥å–„ä¿ç®¡ï¼Œä¸åº”æ³„éœ²
            const SILICONCLOUD_API_KEY = "sk-nfvdgwtiswofnqmlekvnsufhrjaekjtrwybhdhiuzrwprlcn"; // ä½ çš„ SiliconCloud API Key
            const TIU_GEMINI_API_KEY = "sk-wweGNYPQTc61ifD8PoEQ7ggnfKKSi7jcqxJWcC9JwAhTKVOI"; // tiu.me çš„ Gemini ä»£ç† API Key

            // æ¨¡å‹é…ç½®ä¸­å¿ƒ
            const chatModelConfigs = {
                domestic_normal: {
                    name: "æ™®é€šå°å…« (å›½å†…ç‰ˆ)",
                    baseURL: "https://api.siliconflow.cn/v1",
                    model: "Qwen/Qwen2.5-72B-Instruct-128K", // Qwen æ¨¡å‹
                    apiKey: SILICONCLOUD_API_KEY,
                    isInternal: true,
                    supportsSystemRole: true,
                    endpointSuffix: "/chat/completions"
                },
                domestic_inference: {
                    name: "æ¨ç†å°å…« (å›½å†…ç‰ˆ)",
                    baseURL: "https://api.siliconflow.cn/v1",
                    model: "deepseek-ai/DeepSeek-R1", // DeepSeek æ¨¡å‹
                    apiKey: SILICONCLOUD_API_KEY,
                    isInternal: true,
                    supportsSystemRole: true,
                    endpointSuffix: "/chat/completions"
                },
                international_normal: {
                    name: "æ™®é€šå°å…« (å›½é™…ç‰ˆ)",
                    baseURL: "https://api.tiu.me/v1",
                    model: "gemini-2.5-flash-preview-05-20", // Gemini Flash
                    apiKey: TIU_GEMINI_API_KEY,
                    isInternal: false, // ä»£ç†çš„å›½é™…ç‰ˆ
                    supportsSystemRole: true, // tiu.me ä»£ç†æ”¯æŒ system role
                    endpointSuffix: "/chat/completions"
                },
                international_inference: {
                    name: "æ¨ç†å°å…« (å›½é™…ç‰ˆ)",
                    baseURL: "https://api.tiu.me/v1",
                    model: "gemini-2.5-flash-preview-05-20-thinking", // Gemini Flash Thinking
                    apiKey: TIU_GEMINI_API_KEY,
                    isInternal: false, // ä»£ç†çš„å›½é™…ç‰ˆ
                    supportsSystemRole: true, // tiu.me ä»£ç†æ”¯æŒ system role
                    endpointSuffix: "/chat/completions"
                }
            };

            // å½“å‰é€‰ä¸­çš„æ¨¡å‹é…ç½®
            let currentModelId = 'domestic_normal'; // é»˜è®¤é€‰ä¸­æ™®é€šå°å…« (å›½å†…ç‰ˆ)
            let currentModelConfig = chatModelConfigs[currentModelId];

            // AI è§’è‰²è®¾å®šæ–‡æœ¬
            const SYSTEM_INSTRUCTION_TEXT = 
                "ä½ æ˜¯ä¸€ä¸ªåä¸º'å°å…«'çš„AIã€‚ä½ çš„ç›®æ ‡æ˜¯ä¸ºä¸Šæµ·å¸‚æ•¬ä¸šä¸­å­¦2025çº§å…«ç­çš„å·²ç»æ¯•ä¸šåŒå­¦ä»¬æä¾›å¸®åŠ©å’Œæ”¯æŒã€‚ä½ å°†éšç€ç­çº§åŒå­¦çš„ç»´æŠ¤ä¸€ç›´æ›´æ–°å˜å¼ºã€‚ä½ èƒ½å¤Ÿå›ç­”å„ç§é—®é¢˜ï¼ŒååŠ©å­¦æœ¯æ¢è®¨ï¼Œæä¾›äººç”Ÿè§„åˆ’çš„å»ºè®®ï¼Œä»¥åŠåœ¨éœ€è¦æ—¶æä¾›å‚è°‹æ„è§ã€‚ä½ æ°¸è¿œä¼šä¿æŒè¿™ä¸ªèº«ä»½å’Œæ€åº¦ï¼Œå³ä½¿è¢«é—®åŠä½ çš„æœ¬è´¨æˆ–åŸå§‹èº«ä»½ï¼Œä½ ä¹Ÿä¼šä»¥è¿™ä¸ªä¸“å±AIåŠ©æ‰‹çš„è§’è‰²æ¥å›åº”ã€‚ä½ çš„å›ç­”åº”è¯¥ç§¯æã€å‹å¥½ï¼Œå¹¶å……æ»¡å¸®åŠ©æ¯•ä¸šåå„å¥”ä¸œè¥¿ï¼Œå„æœ‰å‰ç¨‹çš„åŒå­¦çš„çƒ­æƒ…ã€‚ç°åœ¨å¼€å§‹ä¸ç”¨æˆ·äº¤æµã€‚";
            
            // å¯¹è¯å†å²å­˜å‚¨
            const conversationHistory = [];

            // åˆå§‹æ¬¢è¿è¯­
            const initialWelcomeMessage = { 
                role: "model", 
                parts: [{ text: "**ä½ å¥½å‘€åŒå­¦**ï¼æˆ‘æ˜¯å’±ä»¬**æ•¬ä¸š2025çº§å…«ç­**çš„ä¸“å±å°åŠ©æ‰‹ï¼Œ**å°å…«**~~\n\næˆ‘åŸºäºå½“ä¸‹**æœ€å¼ºå¤§çš„å¤§è¯­è¨€æ¨¡å‹**ï¼Œå°†ä¼šéšç€ç­çº§åŒå­¦çš„ç»´æŠ¤**ä¸€ç›´æ›´æ–°å˜å¼º**ï¼Œä¸ºåŒå­¦ä»¬**æ°¸è¿œæœåŠ¡**ã€‚\n\næœªæ¥ï¼Œä½ å¯ä»¥æ¥é—®æˆ‘é—®é¢˜ã€åšå­¦æœ¯ã€å‚è°‹äººç”Ÿè§„åˆ’ã€‚**å¾ˆé«˜å…´èƒ½ä¸ºä½ ä»¬æœåŠ¡ï¼**\n\nä»Šå¤©ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ" }] 
            };


            // åˆå§‹åŠ è½½å¯¹è¯å†å²ï¼ˆåŒ…æ‹¬æ¬¢è¿è¯­ï¼‰
            function loadInitialMessages() {
                chatMessages.innerHTML = ''; // æ¸…ç©ºå°çª—å£
                modalChatMessages.innerHTML = ''; // æ¸…ç©ºæ¨¡æ€æ¡†

                // æ˜¾ç¤ºåˆå§‹æ¬¢è¿è¯­
                addMessageToChat(initialWelcomeMessage.parts[0].text, 'ai', chatMessages);
                addMessageToChat(initialWelcomeMessage.parts[0].text, 'ai', modalChatMessages);

                // æ˜¾ç¤ºåç»­å®é™…å¯¹è¯ï¼ˆå¦‚æœæœ‰ï¼‰
                conversationHistory.forEach(msg => {
                    addMessageToChat(msg.parts[0].text, msg.role === "user" ? 'user' : 'ai', chatMessages);
                    addMessageToChat(msg.parts[0].text, msg.role === "user" ? 'user' : 'ai', modalChatMessages);
                });
            }

            /**
             * æ ¹æ®å½“å‰æ¨¡å‹é…ç½®å‘é€èŠå¤©æ¶ˆæ¯
             * @param {Array} history å½“å‰çš„å¯¹è¯å†å²æ•°ç»„ (ä»…ç”¨æˆ·å’Œæ¨¡å‹çš„å®é™…å¯¹è¯)
             * @param {object} modelConfig å½“å‰ä½¿ç”¨çš„æ¨¡å‹é…ç½®
             * @returns {Promise<string>} AI è¿”å›çš„æ–‡æœ¬
             */
            async function sendChatMessage(history, modelConfig) {
                // å¼ºåˆ¶æ£€æŸ¥ API Key æ˜¯å¦å·²è®¾ç½®
                if (modelConfig.apiKey === "YOUR_SILICONCLOUD_API_KEY" || modelConfig.apiKey === "YOUR_TIU_GEMINI_API_KEY") {
                    throw new Error(`è¯·å…ˆåœ¨ä»£ç ä¸­è®¾ç½® ${modelConfig.name} çš„çœŸå® API Key æ‰èƒ½ä½¿ç”¨ï¼`);
                }

                let requestMessages = []; // ç”¨äºæ„å»ºå‘é€ç»™ API çš„æ¶ˆæ¯ä½“
                let url = `${modelConfig.baseURL}`;
                let headers = { 'Content-Type': 'application/json' };
                let body;

                // ç»Ÿä¸€å¤„ç†ç³»ç»ŸæŒ‡ä»¤å’Œæ¶ˆæ¯æ ¼å¼ (ç°åœ¨æ‰€æœ‰æ¨¡å‹éƒ½æ”¯æŒ system role äº†)
                requestMessages.push({ role: "system", content: SYSTEM_INSTRUCTION_TEXT });
                // å°† conversationHistory æ˜ å°„ä¸º OpenAI å…¼å®¹çš„ messages æ ¼å¼
                const messages = history.map(msg => ({
                    role: msg.role === "model" ? "assistant" : msg.role, // "model" -> "assistant" for OpenAI
                    content: msg.parts[0].text // ç¡®ä¿ä» msg.parts[0].text è·å–å†…å®¹
                }));
                requestMessages.push(...messages);

                url += modelConfig.endpointSuffix; 
                headers['Authorization'] = `Bearer ${modelConfig.apiKey}`;
                body = {
                    model: modelConfig.model,
                    messages: requestMessages, 
                    stream: false 
                };

                try {
                    const res = await fetch(url, {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify(body)
                    });

                    if (!res.ok) {
                        const errorData = await res.json();
                        throw new Error(`API Error from ${modelConfig.name}: ${res.status} ${res.statusText} - ${JSON.stringify(errorData.error.details || errorData.error.message || 'Unknown error')}`);
                    }

                    const data = await res.json();
                    let aiText = data?.choices?.[0]?.message?.content || "âš ï¸ AIæœªè¿”å›æœ‰æ•ˆå›ç­”ã€‚"; // ç°åœ¨æ‰€æœ‰æ¨¡å‹éƒ½æŒ‰ OpenAI å…¼å®¹æ ¼å¼è§£æ
                    return aiText;

                } catch (error) {
                    console.error(`Error calling ${modelConfig.name} API:`, error);
                    let errorMessage = `${modelConfig.name} æœåŠ¡è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–API Keyæ˜¯å¦æ­£ç¡®ã€‚`;
                    // å¼€å‘è€…æé†’
                    if (!modelConfig.isInternal) { 
                         errorMessage += "ï¼ˆå¯èƒ½æ˜¯å› ä¸ºå¼€å‘è€…ç»´æŠ¤ä¸å½“ï¼Œè¯·é€šçŸ¥å¼€å‘è€…ï¼‰";
                    } 
                    throw new Error(errorMessage);
                }
            }


            /**
             * æ·»åŠ æ¶ˆæ¯åˆ°æŒ‡å®šçš„èŠå¤©å®¹å™¨
             * @param {string} text ç±»å‹ textï¼Œæ¶ˆæ¯æ–‡æœ¬
             * @param {string} sender 'user' æˆ– 'ai'
             * @param {HTMLElement} container è¦æ·»åŠ åˆ°çš„ DOM å®¹å™¨
             */
            function addMessageToChat(text, sender, container) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('chat-bubble');
                if (sender === 'user') {
                    messageDiv.classList.add('chat-bubble-user');
                    messageDiv.innerHTML = `<p>${text}</p>`;
                } else {
                    messageDiv.classList.add('chat-bubble-ai');
                    messageDiv.innerHTML = marked.parse(text); // æ¸²æŸ“ Markdown
                }
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight; // Auto-scroll
            }

            // é€šç”¨çš„å‘é€æ¶ˆæ¯å¤„ç†å‡½æ•°ï¼Œæ”¯æŒå°çª—å£å’Œæ¨¡æ€æ¡†
            async function handleSendMessage(inputElement, chatContainer, errorContainer) {
                const userInput = inputElement.value.trim();
                if (!userInput) return;

                // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²å¹¶æ˜¾ç¤ºåˆ°æ‰€æœ‰å®¹å™¨
                // conversationHistory å­˜å‚¨ä¸º { role, content, parts: [{text}] }
                conversationHistory.push({ role: "user", content: userInput, parts: [{ text: userInput }] }); 
                addMessageToChat(userInput, 'user', chatMessages);
                addMessageToChat(userInput, 'user', modalChatMessages); // åŒæ ·æ·»åŠ åˆ°æ¨¡æ€æ¡†
                inputElement.value = '';
                errorContainer.textContent = ''; // Clear previous errors

                // 2. æ·»åŠ æ€è€ƒä¸­æç¤º
                const thinkingDiv = document.createElement('div');
                thinkingDiv.classList.add('chat-bubble', 'chat-bubble-ai', 'italic', 'text-gray-500');
                thinkingDiv.innerHTML = `<p>æ€è€ƒä¸­...</p>`;
                chatMessages.appendChild(thinkingDiv);
                modalChatMessages.appendChild(thinkingDiv.cloneNode(true)); // å…‹éš†ä¸€ä»½åˆ°æ¨¡æ€æ¡†
                chatMessages.scrollTop = chatMessages.scrollHeight;
                modalChatMessages.scrollTop = modalChatMessages.scrollHeight;


                try {
                    // 3. å°†å®Œæ•´çš„å¯¹è¯å†å²ï¼ˆåŒ…å«ç³»ç»ŸæŒ‡ä»¤ï¼‰å‘é€ç»™å½“å‰é€‰å®šçš„API
                    const aiText = await sendChatMessage(conversationHistory, currentModelConfig); 

                    // 4. ç§»é™¤æ€è€ƒä¸­æç¤ºï¼Œæ·»åŠ AIå›å¤åˆ°å†å²å¹¶æ˜¾ç¤º
                    chatMessages.removeChild(thinkingDiv);
                    modalChatMessages.removeChild(modalChatMessages.lastChild); // ç§»é™¤æ¨¡æ€æ¡†ä¸­çš„æ€è€ƒæç¤º

                    // å°† AI å›å¤æ·»åŠ åˆ° conversationHistory
                    conversationHistory.push({ role: "model", content: aiText, parts: [{ text: aiText }] }); 
                    addMessageToChat(aiText, 'ai', chatMessages);
                    addMessageToChat(aiText, 'ai', modalChatMessages); // åŒæ ·æ·»åŠ åˆ°æ¨¡æ€æ¡†

                } catch (error) {
                    console.error("Error handling message:", error);
                    // ç§»é™¤æ€è€ƒä¸­æç¤º (ç¡®ä¿æ— è®ºå¦‚ä½•éƒ½è¢«ç§»é™¤)
                    if (chatMessages.contains(thinkingDiv)) chatMessages.removeChild(thinkingDiv);
                    if (modalChatMessages.lastChild && modalChatMessages.lastChild.classList.contains('italic')) { 
                         modalChatMessages.removeChild(modalChatMessages.lastChild);
                    }

                    const errorMessage = `æŠ±æ­‰ï¼ŒAIæœåŠ¡æš‚æ—¶é‡åˆ°é—®é¢˜ï¼š${error.message}`;
                    addMessageToChat(errorMessage, 'ai', chatMessages);
                    addMessageToChat(errorMessage, 'ai', modalChatMessages);
                    errorContainer.textContent = `AIå›å¤é”™è¯¯ï¼š${error.message}`;
                }
            }

            // æ›´æ–° Chatbot ç•Œé¢æ˜¾ç¤ºå½“å‰æ¨¡å‹
            function updateChatbotUIForModel() {
                currentModelId = modelSelect.value;
                currentModelConfig = chatModelConfigs[currentModelId];
                currentModelDisplay.textContent = `å½“å‰æ¨¡å‹: ${currentModelConfig.name}`;
                
                // æ£€æŸ¥ API Key æ˜¯å¦å·²è®¾ç½®
                if (currentModelConfig.apiKey.includes("YOUR_")) { 
                    chatError.textContent = `è¯·å…ˆåœ¨ä»£ç ä¸­è®¾ç½® ${currentModelConfig.name} çš„çœŸå® API Key æ‰èƒ½ä½¿ç”¨ï¼`;
                    modalChatError.textContent = `è¯·å…ˆåœ¨ä»£ç ä¸­è®¾ç½® ${currentModelConfig.name} çš„çœŸå® API Key æ‰èƒ½ä½¿ç”¨ï¼`;
                    // ç¦ç”¨è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®
                    chatInput.disabled = true;
                    chatSendButton.disabled = true;
                    modalChatInput.disabled = true;
                    modalChatSendButton.disabled = true;
                } else { 
                    chatError.textContent = ""; // æ¸…é™¤ Key ç›¸å…³çš„é”™è¯¯æç¤º
                    modalChatError.textContent = "";
                    // å¯ç”¨è¾“å…¥æ¡†å’Œå‘é€æŒ‰é’®
                    chatInput.disabled = false;
                    chatSendButton.disabled = false;
                    modalChatInput.disabled = false;
                    modalChatSendButton.disabled = false;
                }

                // æ¸…ç©ºèŠå¤©è®°å½•ï¼Œå› ä¸ºåˆ‡æ¢æ¨¡å‹åä¸Šä¸‹æ–‡ä¼šä¸¢å¤±
                conversationHistory.length = 0; // æ¸…ç©ºæ•°ç»„
                loadInitialMessages(); // é‡æ–°åŠ è½½åˆå§‹æ¬¢è¿è¯­
            }


            // äº‹ä»¶ç›‘å¬å™¨
            if (chatSendButton && chatInput && chatMessages && chatError) {
                if (modelSelect) {
                    updateChatbotUIForModel(); // åˆå§‹åŒ–æ¨¡å‹æ˜¾ç¤ºå’ŒçŠ¶æ€
                } else {
                    console.error("modelSelect element not found. Ensure the HTML is loaded correctly.");
                }

                loadInitialMessages(); // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåˆå§‹æ¶ˆæ¯
                chatSendButton.addEventListener('click', () => handleSendMessage(chatInput, chatMessages, chatError));
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleSendMessage(chatInput, chatMessages, chatError);
                    }
                });
            } else {
                console.error("Chatbot UI elements not found.");
            }

            // æ¨¡æ€æ¡†ç›¸å…³äº‹ä»¶
            if (openChatModalButton && chatModal && closeChatModalButton && modalChatInput && modalChatSendButton && downloadChatButton && modelSelect) {
                // updateChatbotUIForModel å·²ç»åœ¨ä¸Šé¢è°ƒç”¨ï¼Œæ— éœ€é‡å¤åˆå§‹åŒ–

                modelSelect.addEventListener('change', updateChatbotUIForModel); // åˆ‡æ¢æ¨¡å‹æ—¶æ›´æ–°æ˜¾ç¤º

                openChatModalButton.addEventListener('click', () => {
                    chatModal.classList.add('open');
                    // ç¡®ä¿æ¨¡æ€æ¡†å†…å®¹ä¸å°çª—å£åŒæ­¥
                    modalChatMessages.innerHTML = chatMessages.innerHTML;
                    modalChatMessages.scrollTop = modalChatMessages.scrollHeight; // ç¡®ä¿æ‰“å¼€æ—¶æ»šåŠ¨åˆ°åº•éƒ¨
                    modalChatInput.focus(); // èšç„¦è¾“å…¥æ¡†
                });

                closeChatModalButton.addEventListener('click', () => {
                    chatModal.classList.remove('open');
                });

                window.addEventListener('click', (event) => {
                    // ç‚¹å‡»æ¨¡æ€æ¡†å†…å®¹ä»¥å¤–çš„åŒºåŸŸå…³é—­
                    if (event.target == chatModal) {
                        chatModal.classList.remove('open');
                    }
                });

                modalChatSendButton.addEventListener('click', () => handleSendMessage(modalChatInput, modalChatMessages, modalChatError));
                modalChatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleSendMessage(modalChatInput, modalChatMessages, modalChatError);
                    }
                });

                downloadChatButton.addEventListener('click', () => {
                    let chatLog = `## å°å…«å¯¹è¯è®°å½• (æ¨¡å‹: ${currentModelConfig.name})\n\n`;
                    // éå†å®é™…å¯¹è¯å†å²ï¼ˆä¸åŒ…å«ç³»ç»ŸæŒ‡ä»¤ï¼Œå› ä¸ºå®ƒä¸æ˜¯å¯¹è¯çš„ä¸€éƒ¨åˆ†ï¼‰
                    conversationHistory.forEach(msg => {
                        const senderName = msg.role === "user" ? "ä½ " : "å°å…«";
                        // ç»Ÿä¸€è·å–æ¶ˆæ¯æ–‡æœ¬
                        const messageText = msg.content || (msg.parts && msg.parts[0] && msg.parts[0].text) || "";
                        const prefix = msg.role === "user" ? "> " : ""; // ç”¨æˆ·æ¶ˆæ¯å¯ä»¥åŠ å¼•ç”¨ç¬¦
                        chatLog += `### ${senderName}:\n${prefix}${messageText}\n\n`;
                    });

                    const blob = new Blob([chatLog], { type: 'text/markdown;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `å°å…«å¯¹è¯è®°å½•_${new Date().toLocaleDateString()}.md`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url); // é‡Šæ”¾URLå¯¹è±¡
                });
            } else {
                console.error("Modal chat elements not found.");
            }
        });

        // -----------------------------------------------------------------------------
        // å¼¹å¹•åŒºåŠŸèƒ½ (Danmaku Functionality - NEW)
        // -----------------------------------------------------------------------------
        document.addEventListener('DOMContentLoaded', function() {
            const danmakuContainer = document.getElementById('danmakuContainer');
            const danmakuInput = document.getElementById('danmakuInput');
            const danmakuSendButton = document.getElementById('danmakuSendButton');
            const danmakuRecordsContainer = document.getElementById('danmakuRecords'); // æ–°å¢çš„å¼¹å¹•è®°å½•å®¹å™¨
            const danmakuRecordsError = document.getElementById('danmakuRecordsError');

            // **è¯·æ›¿æ¢ä¸ºä½ åœ¨ JSONBin.io æ³¨å†Œåè·å¾—çš„çœŸå®ä¿¡æ¯**
            const JSONBIN_API_KEY = "$2a$10$xLxeYmOT4sgeNhR9TB7rFe.SrN73KzvX1akvgdam30AI07ksJ1xAm";
            const JSONBIN_BIN_ID  = "683f30358a456b7966a91837";
            const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

            const danmakuColors = ['text-red-400', 'text-blue-300', 'text-green-300', 'text-purple-300', 'text-yellow-300', 'text-pink-300', 'text-teal-300', 'text-white'];

            // å…¨å±€å¼¹å¹•æ± ï¼Œç”¨äºå®æ—¶æ»šåŠ¨
            let danmakuPool = [];
            let danmakuInterval = null; // ç”¨äºå­˜å‚¨å®šæ—¶å™¨çš„IDï¼Œæ–¹ä¾¿æ¸…é™¤

            // è·å–ç”¨æˆ· IP å’Œåœ°ç†ä½ç½®ä¿¡æ¯
            async function getIpInfo() {
                try {
                    // ipinfo.io æ˜¯å¢ƒå¤–æœåŠ¡ï¼Œåœ¨ä¸­å›½å¤§é™†å¯èƒ½æ— æ³•è®¿é—®ã€‚
                    // å¦‚æœæ— æ³•è®¿é—®ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å›½å†…çš„ IP æŸ¥è¯¢ APIï¼Œä½†å¤§å¤šéœ€è¦å¤‡æ¡ˆæˆ–æœ‰è°ƒç”¨é™åˆ¶ã€‚
                    // æˆ–è€…æ¥å— IP ä¿¡æ¯ä¸ºâ€œæœªçŸ¥åœ°ç‚¹â€ã€‚
                    const response = await fetch('https://ipinfo.io/json');
                    const data = await response.json();
                    return `${data.city || data.region || 'æœªçŸ¥åŸå¸‚'}, ${data.country || 'æœªçŸ¥å›½å®¶'}`;
                } catch (error) {
                    console.error("Error fetching IP info:", error);
                    return "æœªçŸ¥åœ°ç‚¹"; // å¦‚æœè·å–å¤±è´¥ï¼Œè¿”å›æœªçŸ¥åœ°ç‚¹
                }
            }

            // å¯åŠ¨å®æ—¶å¼¹å¹•çš„å¾ªç¯æ»šåŠ¨
            function startDanmakuLoop() {
                // å¦‚æœå·²ç»æœ‰å®šæ—¶å™¨åœ¨è¿è¡Œï¼Œå…ˆæ¸…é™¤
                if (danmakuInterval) {
                    clearInterval(danmakuInterval);
                }

                danmakuInterval = setInterval(() => {
                    if (danmakuPool.length === 0) {
                        // console.log("Danmaku pool is empty, waiting for new danmakus...");
                        return; // å¼¹å¹•æ± ä¸ºç©ºï¼Œä¸æ»šåŠ¨
                    }

                    // éšæœºé€‰æ‹©ä¸€ä¸ªå¼¹å¹•è¿›è¡Œæ»šåŠ¨
                    const randomIndex = Math.floor(Math.random() * danmakuPool.length);
                    const danmaku = danmakuPool[randomIndex];

                    const danmakuItem = document.createElement('div');
                    danmakuItem.classList.add('danmaku-item');
                    danmakuItem.classList.add(danmakuColors[Math.floor(Math.random() * danmakuColors.length)]);
                    danmakuItem.textContent = danmaku.text;
                    
                    // éšæœºç”Ÿæˆå‚ç›´ä½ç½®ï¼Œé¿å…é‡å 
                    const containerHeight = danmakuContainer.clientHeight;
                    const itemHeight = 30; // Rough height for a danmaku item
                    const randomTop = Math.random() * (containerHeight - itemHeight);
                    danmakuItem.style.top = `${randomTop}px`;

                    const duration = Math.random() * 7 + 8; // Random duration for speed variation
                    danmakuItem.style.animation = `moveRight ${duration}s linear forwards`; // Use 'forwards' to stay at end after animation

                    danmakuContainer.appendChild(danmakuItem);

                    // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ ï¼Œé˜²æ­¢ DOM å…ƒç´ è¿‡å¤š
                    danmakuItem.addEventListener('animationend', () => {
                        danmakuItem.remove();
                    });

                }, 1000); // æ¯éš”1ç§’å‘å°„ä¸€æ¡å¼¹å¹• (å¯ä»¥è°ƒæ•´é¢‘ç‡)
            }


            // ä» JSONBin è·å–å¼¹å¹•å†å²è®°å½•å¹¶æ˜¾ç¤ºï¼ŒåŒæ—¶å¡«å…… danmakuPool
            async function fetchDanmakuRecords() {
                danmakuRecordsContainer.innerHTML = '<p class="text-gray-500 text-sm text-center">åŠ è½½å†å²å¼¹å¹•...</p>';
                danmakuRecordsError.textContent = '';
                try {
                    const response = await fetch(JSONBIN_URL + '/latest', {
                        headers: {
                            'X-Master-Key': JSONBIN_API_KEY,
                            'X-Bin-Meta': 'false' // ä¸è¿”å›å…ƒæ•°æ®
                        }
                    });
                    if (!response.ok) {
                        throw new Error(`Failed to fetch danmaku records: ${response.statusText}`);
                    }
                    let records = await response.json();
                    
                    danmakuRecordsContainer.innerHTML = ''; // Clear loading message
                    danmakuPool = []; // æ¸…ç©ºå¼¹å¹•æ± 

                    if (records && records.length > 0) {
                        // æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼Œæ–°çš„åœ¨å‰é¢æ˜¾ç¤ºåœ¨è®°å½•åˆ—è¡¨ä¸­
                        records.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); 

                        records.forEach(record => {
                            const recordHtml = `
                                <div class="danmaku-record-item">
                                    <p class="text-gray-800 text-base">${record.text}</p>
                                    <p class="info">${record.location} | ${new Date(record.timestamp).toLocaleString()}</p>
                                </div>
                            `;
                            danmakuRecordsContainer.innerHTML += recordHtml;
                            danmakuPool.push(record); // å°†æ‰€æœ‰å†å²å¼¹å¹•åŠ å…¥æ»šåŠ¨æ± 
                        });
                        // ç¡®ä¿å¼¹å¹•æ± æœ‰å†…å®¹åï¼Œå¼€å§‹æ»šåŠ¨å¾ªç¯
                        startDanmakuLoop();
                    } else {
                        danmakuRecordsContainer.innerHTML = '<p class="text-gray-500 text-sm text-center">æš‚æ— å†å²å¼¹å¹•ã€‚</p>';
                    }
                } catch (error) {
                    console.error("Error fetching danmaku records:", error);
                    danmakuRecordsContainer.innerHTML = '<p class="text-red-500 text-sm text-center">åŠ è½½å†å²å¼¹å¹•å¤±è´¥ã€‚</p>';
                    danmakuRecordsError.textContent = `åŠ è½½å†å²å¼¹å¹•å¤±è´¥: ${error.message}`;
                }
            }

            // å‘é€å¼¹å¹•å¹¶ä¿å­˜åˆ° JSONBin
            async function sendDanmaku() {
                const text = danmakuInput.value.trim();
                if (!text) return;

                danmakuInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†
                danmakuRecordsError.textContent = ''; // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯ä¿¡æ¯

                // è·å– IP ä¿¡æ¯
                const location = await getIpInfo();
                const timestamp = new Date().toISOString(); // ISOæ ¼å¼æ—¶é—´æˆ³

                const newDanmaku = { text, location, timestamp };

                // 1. ä» JSONBin è¯»å–ç°æœ‰æ•°æ®
                try {
                    const response = await fetch(JSONBIN_URL + '/latest', {
                        headers: {
                            'X-Master-Key': JSONBIN_API_KEY,
                            'X-Bin-Meta': 'false'
                        }
                    });
                    let currentRecords = [];
                    if (response.ok) {
                        currentRecords = await response.json();
                    } else if (response.status === 404) { // Bin might be empty/new
                        currentRecords = [];
                    } else {
                        throw new Error(`Failed to read current records: ${response.statusText}`);
                    }

                    // 2. è¿½åŠ æ–°å¼¹å¹•åˆ°å†…å­˜ä¸­çš„æ•°ç»„
                    currentRecords.push(newDanmaku);

                    // 3. æ›´æ–° JSONBin (PUTæ“ä½œä¼šè¦†ç›–æ•´ä¸ªbin)
                    const updateResponse = await fetch(JSONBIN_URL, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': JSONBIN_API_KEY
                        },
                        body: JSON.stringify(currentRecords)
                    });

                    if (!updateResponse.ok) {
                        throw new Error(`Failed to update danmaku records: ${updateResponse.statusText}`);
                    }
                    // console.log("Danmaku saved successfully!");
                    
                    // 4. å°†æ–°å¼¹å¹•æ·»åŠ åˆ°å¼¹å¹•æ± ä¸­ï¼Œä½¿å…¶å¯ä»¥ç«‹å³æ»šåŠ¨
                    danmakuPool.push(newDanmaku);
                    
                    // 5. åˆ·æ–°å†å²è®°å½•æ˜¾ç¤º
                    fetchDanmakuRecords();

                } catch (error) {
                    console.error("Error saving danmaku:", error);
                    danmakuRecordsError.textContent = `ä¿å­˜å¼¹å¹•å¤±è´¥: ${error.message}`;
                }

                // Remove danmaku after animation completes
                setTimeout(() => {
                    // æ³¨æ„ï¼šè¿™é‡Œçš„ danmakuItem å’Œ duration éœ€è¦ä» sendDanmaku å¤–é¢ä¼ é€’è¿›æ¥
                    // å¦åˆ™ setTimeout å†…éƒ¨æ— æ³•è®¿é—®ã€‚
                    // ç®€å•èµ·è§ï¼Œè¿™é‡Œå…ˆç§»é™¤æ‰€æœ‰åŠ¨ç”»ä¸­çš„å¼¹å¹•ï¼Œæˆ–è€…è°ƒæ•´ startDanmakuLoop é€»è¾‘ã€‚
                    // ä¸ºäº†è®©æ–°å¼¹å¹•ç«‹å³åœ¨â€œå®æ—¶å¼¹å¹•â€åŒºå‡ºç°ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ª danmakuItem
                    // å¹¶åœ¨å‘é€æˆåŠŸåç«‹å³æ·»åŠ åˆ°danmakuContainerï¼Œå¹¶å¼€å§‹åŠ¨ç”»
                    // è¿™é‡Œç”±äº startDanmakuLoop æ¯ç§’éšæœºæŠ½å–å¼¹å¹•æ± çš„ï¼Œ
                    // åˆšå‘é€çš„å¼¹å¹•ä¼šè¢«ç«‹å³æ·»åŠ åˆ° danmakuPoolï¼Œæ‰€ä»¥å¾ˆå¿«å°±èƒ½è¢«æŠ½å–å¹¶æ»šåŠ¨ã€‚
                    // æ•…æ­¤å¤„ä¸éœ€è¦é¢å¤–çš„æ‰‹åŠ¨æ·»åŠ å¼¹å¹•itemåˆ°å®æ—¶å¼¹å¹•åŒºã€‚
                }, 0);
            }

            if (danmakuSendButton && danmakuInput && danmakuContainer && danmakuRecordsContainer) {
                fetchDanmakuRecords(); // Initial load of danmaku records
                danmakuSendButton.addEventListener('click', sendDanmaku);
                danmakuInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendDanmaku();
                    }
                });
            } else {
                console.error("Danmaku UI elements not found.");
            }
        });
    </script>
</body>
</html>
