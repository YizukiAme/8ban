<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八贤渡 · 敬业舟</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- 引入 Marked.js 用于 Markdown 渲染 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Base styles */
        body {
            font-family: 'Noto Sans SC', sans-serif;
            color: #2d3748;
            overflow-x: hidden;
            scroll-behavior: smooth; /* Ensure smooth scrolling works */
            
            /* 修复顶部白框问题：body的背景色与固定背景的fallback色一致 */
            background-color: #1a202c; /* 深色背景，与固定背景的初始/fallback色保持一致 */
        }

        /* Glassmorphism effect */
        .glassmorphism {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        /* Card hover effects */
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 28px 0 rgba(31, 38, 135, 0.2);
        }
        .enhanced-card-hover {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .enhanced-card-hover:hover {
            transform: scale(1.03) translateY(-3px);
            box-shadow: 0 15px 30px -5px rgba(59, 130, 246, 0.25), 0 8px 10px -6px rgba(59, 130, 246, 0.2);
        }

        /* Highlight text (existing) */
        .highlight-text {
            position: relative;
            display: inline-block;
        }
        .highlight-text::after {
            content: none;
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background-color: rgba(99, 102, 241, 0.2);
            z-index: -1;
        }

        /* Mobile menu (existing) */
        .mobile-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            padding: 1rem;
            margin: 0.5rem;
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            transform-origin: top;
            transform: scaleY(0);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 100;
        }
        .mobile-menu.active {
            transform: scaleY(1);
            opacity: 1;
        }

        /* Tool area reveal animation (existing) */
        .tools-grid-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.7s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.5s ease-out, transform 0.5s ease-out;
            opacity: 0;
            transform: translateY(20px);
        }
        .tools-grid-container.active {
            max-height: 2000px; /* Adjust if needed for more tools */
            opacity: 1;
            transform: translateY(0);
        }

        /* Chat bubble styles (existing) */
        .chat-bubble {
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
            max-width: 75%;
            word-wrap: break-word;
        }
        .chat-bubble-user {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 0.25rem;
        }
        .chat-bubble-ai {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
            margin-right: auto;
            border-bottom-left-radius: 0.25rem;
        }
        .chat-bubble-ai p:first-child { margin-top: 0; }
        .chat-bubble-ai p:last-child { margin-bottom: 0; }
        .chat-bubble-ai pre {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 0.75rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }
        .chat-bubble-ai code {
            background-color: #cbd5e0;
            padding: 0.2em 0.4em;
            border-radius: 0.25rem;
            font-size: 0.875em;
        }
        .chat-bubble-ai ul, .chat-bubble-ai ol {
            margin-left: 1.25rem;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
            list-style-type: disc;
        }
        .chat-bubble-ai ol {
            list-style-type: decimal;
        }
        #chatMessages {
            scroll-behavior: smooth;
        }

        /* Danmaku animation (existing) */
        @keyframes moveRight {
            0% { transform: translateX(-100%); opacity: 1;}
            90% { opacity: 1; }
            100% { transform: translateX(100vw); opacity: 0; }
        }
        .danmaku-item {
            position: absolute;
            white-space: nowrap;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 5px;
            background-color: rgba(0,0,0,0.1);
        }

        /* Timeline dot (existing) */
        .timeline-dot {
            width: 12px;
            height: 12px;
            background-color: #60a5fa;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 0 3px #60a5fa;
        }

        /* Modal Chatbot Styles (existing) */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(8px);
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .modal.open {
            display: flex;
            opacity: 1;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            position: relative;
            width: 90%;
            max-width: 1500px;
            height: 90%;
            max-height: 1200px;
            display: flex;
            flex-direction: column;
            transform: translateY(20px);
            opacity: 0;
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .modal.open .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            color: #aaa;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close:hover,
        .modal-close:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            background-color: #f8fafc;
        }
        .modal-chat-input-area {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding-top: 0.5rem;
        }

        /* Danmaku Records Specific Styles (existing) */
        .danmaku-record-item {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        .danmaku-record-item p {
            margin: 0;
            line-height: 1.4;
        }
        .danmaku-record-item .info {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.5rem;
            text-align: right;
        }


        /* 新增：固定背景层，实现视差滚动 */
        #fixed-background {
            position: fixed; /* 固定在视口 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* 置于所有内容之下 */
            background-size: cover; /* 覆盖整个区域 */
            background-position: center; /* 居中 */
            background-repeat: no-repeat; /* 不重复 */
            filter: brightness(0.6) saturate(1.2); /* 背景滤镜，不影响UI */
            transition: background-image 0.5s ease-in-out; /* 图片切换动画 */
            background-color: #1a202c; /* 作为图片加载前的fallback色 */
            
            /* 解决移动端固定背景闪烁问题 */
            -webkit-backface-visibility: hidden; /* For iOS Safari */
            backface-visibility: hidden;
            transform: translateZ(0);            /* Force hardware acceleration */
            will-change: transform;              /* Hint browser about future transformations */
        }

        /* New styles for Hero Section and Animations */
        #hero-section {
            position: relative; /* 确保内容在其z-index层级上 */
            min-height: 100vh; /* Make it take full viewport height */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            overflow: hidden; /* Ensure content doesn't spill */
        }
        
        /* 移除 #hero-bg-image 的样式，因为它已被固定背景层取代 */


        #hero-content {
            z-index: 10; /* Bring content to front */
            padding: 1rem;
            max-width: 900px;
            margin: 0 auto;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4); /* Text shadow for readability */
            opacity: 0; /* Initial hidden state for animation */
            transform: translateY(20px);
            animation: fadeInSlideUp 1.2s ease-out forwards 0.5s; /* Fade in and slide up after a delay */
        }

        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #hero-section h1 {
        font-size: 4.5rem; /* 增大标题，从3.5rem改为4.5rem (约72px) */
        font-weight: 700; /* font-bold */
        margin-bottom: 1.5rem; /* mb-6 */
        line-height: 1.2;
        color: white; /* 设置为纯白色 */
        text-align: center;
        text-shadow: 0 4px 12px rgba(0,0,0,0.6), 0 0 20px rgba(0,0,0,0.3); /* 增加更明显的文本阴影，使其在背景上更突出和清晰 */
        
        /* 新增：为标题添加透明度 */
        opacity: 0.8; /* 设置为 90% 不透明，可根据需要调整此值 */
    }

        #hero-section p {
            font-size: 1.5rem; /* text-2xl equivalent */
            color: rgba(255, 255, 255, 0.8); /* Semi-transparent white */
            margin-bottom: 2rem; /* mb-8 */
            text-align: center;
        }

        .scroll-down-arrow {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 2rem;
            animation: bounce 2s infinite; /* Basic bouncing animation */
            cursor: pointer;
            z-index: 10;
            text-shadow: 0 2px 8px rgba(0,0,0,0.4);
            opacity: 0; /* Initial hidden state for animation */
            animation: fadeInBounce 2s infinite forwards 1.5s; /* Fade in then start bouncing */
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateX(-50%) translateY(0);
            }
            40% {
                transform: translateX(-50%) translateY(-10px);
            }
            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }
        @keyframes fadeInBounce {
            0% { opacity: 0; transform: translateX(-50%) translateY(20px); }
            50% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 1; } /* Stay visible for bounce */
        }


        /* Navigation bar initial state (transparent on hero section) */
        .nav-initial {
        background: transparent !important;
        backdrop-filter: none !important;
        box-shadow: none !important;
        /* 增加 opacity 过渡，让导航栏淡入淡出 */
        transition: all 0.5s ease-out, opacity 0.5s ease-out; /* 同时过渡所有属性和 opacity */
        margin-bottom: 0 !important; /* 强制移除 mb-8 */
        
        /* 初始隐藏和禁用点击事件 */
        opacity: 0; /* 默认完全透明 */
        pointer-events: none; /* 禁用鼠标事件，让下方的 hero-section 可以被点击或选择 */
    }

    /* 当滚动时，nav-scrolled 状态会恢复可见和可点击 */
    .nav-scrolled {
        background: rgba(255, 255, 255, 0.7) !important;
        backdrop-filter: blur(10px) !important;
        border-radius: 16px !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15) !important;
        transition: all 0.5s ease-out, opacity 0.5s ease-out; /* 确保过渡效果一致 */
        margin-bottom: 0 !important;
        
        opacity: 1 !important; /* 强制完全不透明 */
        pointer-events: auto !important; /* 恢复鼠标事件，可点击 */
    }


        /* Navigation bar scrolled state (glassmorphism effect) */
        .nav-scrolled {
            background: rgba(255, 255, 255, 0.7) !important;
            backdrop-filter: blur(10px) !important;
            border-radius: 16px !important; /* Already rounded on base */
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15) !important;
            transition: all 0.5s ease-out;
            /* nav-scrolled 状态下的颜色通过JS动态设置，以保证准确性 */
        }


        /* Content sections initial hidden state for scroll reveal */
        .content-section {
            opacity: 0;
            transform: translateY(50px); /* Start slightly below its final position */
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        /* Content sections visible state */
        .content-section.fade-in {
            opacity: 1;
            transform: translateY(0); /* Move to final position */
        }

        /* Adjust button styles for hero section to match the glassmorphism buttons */
        #hero-content a.bg-blue-500, /* 更具体的选择器，确保只修改 hero content 下的按钮 */
        #hero-content a.bg-indigo-500, /* 确保也覆盖同学录按钮 */
        #hero-content a.bg-purple-500,
        #hero-content a.bg-green-500,
        #hero-content a.bg-orange-500 {
            /* 直接引用 glassmorphism 效果的背景和边框 */
            background: rgba(255, 255, 255, 0.2); /* 比 glassmorphism 主体更低的透明度，与截图一致 */
            backdrop-filter: blur(5px); /* 可以是更弱的模糊效果 */
            border: 1px solid rgba(255, 255, 255, 0.3); /* 与 glassmorphism 边框一致 */
            box-shadow: 0 4px 16px 0 rgba(31, 38, 135, 0.1); /* 较弱的阴影 */
            color: white; /* 确保文字是白色 */
            transition: all 0.3s ease;
        }

        /* 悬停效果：保持白色文字，背景颜色可以加深透明度，或保留与背景按钮一致 */
        #hero-content a.bg-blue-500:hover,
        #hero-content a.bg-indigo-500:hover,
        #hero-content a.bg-purple-500:hover,
        #hero-content a.bg-green-500:hover,
        #hero-content a.bg-orange-500:hover {
            background: rgba(255, 255, 255, 0.3); /* 悬停时稍微加深透明度 */
            box-shadow: 0 8px 24px 0 rgba(31, 38, 135, 0.2); /* 悬停时阴影加深 */
            transform: translateY(-3px); /* 维持悬停上移效果 */
            border-color: rgba(255, 255, 255, 0.5); /* 悬停时边框更亮 */
        }

        /* 同学录专属样式 */
        .classmate-card {
            cursor: pointer;
            position: relative;
            overflow: hidden; /* Hide anything outside the card */
        }
        .classmate-card .avatar {
            width: 80px; /* Adjust as needed */
            height: 80px;
            background-color: #6366f1; /* default indigo for avatars */
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px; /* full rounded */
            margin-bottom: 0.5rem;
            flex-shrink: 0; /* Prevent avatar from shrinking */
            user-select: none; /* Prevent selection */
        }
        /* 同学详情模态框的特定样式 */
        .classmate-detail-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
            width: 90%;
            max-width: 600px;
            position: relative;
            display: flex;
            flex-direction: column;
            animation: fadeInScale 0.3s ease-out;
        }
        .classmate-detail-content .avatar-large {
            width: 120px;
            height: 120px;
            background-color: #6366f1;
            color: white;
            font-size: 3.5rem;
            font-weight: bold;
            border-radius: 9999px;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        .classmate-detail-content h3 {
            font-size: 2.25rem;
            font-weight: bold;
            color: #1f2937;
            text-align: center;
            margin-bottom: 0.75rem;
        }
        .classmate-detail-content p {
            color: #4b5563;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        .classmate-detail-content p strong {
            color: #1f2937;
        }
        .classmate-detail-content .quote {
            font-style: italic;
            border-left: 4px solid #a78bfa; /* purple-400 */
            padding-left: 1rem;
            margin-top: 1.5rem;
            color: #6b7280;
            font-size: 0.95rem;
        }
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal.open .classmate-detail-content {
            animation: fadeInScale 0.3s ease-out forwards;
        }

    </style>
</head>
<body class="min-h-screen">
    <!-- 新增：固定背景层，用于实现视差滚动效果 -->
    <div id="fixed-background"></div>

    <!-- Top of Page Anchor - 用于导航条的“首页”链接点击回到页面最顶端 -->
    <div id="top-of-page"></div>

    <!-- 导航条 -->
    <nav class="sticky top-0 z-50 p-4 nav-initial" id="mainNav">
        <div class="container mx-auto flex items-center justify-between">
            <div class="text-xl font-bold">
                <i class="fas fa-book mr-2"></i>八贤渡·敬业舟 - 202508 永久纪念页
            </div>
            <div class="hidden md:flex space-x-6">
                <a href="#top-of-page" class="hover:text-blue-600 transition-colors">首页</a>
                <a href="#memory-area" class="hover:text-blue-600 transition-colors">回忆</a>
                <a href="#classmates-area" class="hover:text-blue-600 transition-colors">同学录</a> <!-- 新增导航链接 -->
                <a href="#tool-area" class="hover:text-blue-600 transition-colors">工具</a>
                <a href="#chatbot-area" class="hover:text-blue-600 transition-colors">Chat with 小八</a>
                <a href="#message-area" class="hover:text-blue-600 transition-colors">留言</a>
            </div>
            <button class="md:hidden focus:outline-none" id="mobileMenuButton" aria-label="导航菜单">
                <i class="fas fa-bars text-xl"></i>
            </button>

            <div class="mobile-menu md:hidden" id="mobileMenu">
                <a href="#top-of-page" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-home mr-3 text-blue-500 w-5 text-center"></i>首页</a>
                <a href="#memory-area" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-images mr-3 text-blue-500 w-5 text-center"></i>回忆</a>
                <a href="#classmates-area" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-users mr-3 text-blue-500 w-5 text-center"></i>同学录</a> <!-- 新增导航链接 -->
                <a href="#tool-area" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-tools mr-3 text-blue-500 w-5 text-center"></i>工具</a>
                <a href="#chatbot-area" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-robot mr-3 text-blue-500 w-5 text-center"></i>Chat with 小八</a>
                <a href="#message-area" class="block py-2 px-3 text-gray-600 hover:text-blue-600 transition-colors rounded-md hover:bg-blue-50 flex items-center"><i class="fas fa-comment-dots mr-3 text-blue-500 w-5 text-center"></i>留言</a>
            </div>
        </div>
    </nav>

    <!-- 英雄区 (首页 - 第一眼看到的内容) -->
    <div id="hero-section">
        <!-- 背景图片通过 #fixed-background div 处理，这里不再需要 img 标签 -->
        
        <div id="hero-content" class="max-w-4xl mx-auto">
            <h1 class="text-4xl md:text-5xl font-bold mb-6">
                <span class="highlight-text">八贤渡 · 敬业舟</span>
            </h1>
            <p class="text-xl md:text-2xl mb-8">从此岸到彼岸，八班风采依旧</p>
            <div class="flex flex-wrap justify-center gap-4">
                <a href="#memory-area" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors text-lg font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <i class="fas fa-images mr-2"></i>回忆
                </a>
                <a href="#classmates-area" class="bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-3 rounded-lg transition-colors text-lg font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <i class="fas fa-users mr-2"></i>同学录
                </a>
                <a href="#tool-area" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg transition-colors text-lg font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <i class="fas fa-tools mr-2"></i>工具
                </a>
                <a href="#chatbot-area" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors text-lg font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <i class="fas fa-robot mr-2"></i>Chat with 小八
                </a>
                <a href="#message-area" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg transition-colors text-lg font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5">
                    <i class="fas fa-comment-dots mr-2"></i>留言
                </a>
            </div>
        </div>
        <!-- 向下滚动箭头 -->
        <i id="scrollDownArrow" class="fas fa-chevron-down scroll-down-arrow"></i>
    </div>

    <!-- 首页介绍内容 (原home section，现在作为第一个通过滚动显现的区块) -->
    <section id="intro-content" class="container mx-auto py-16 px-4 md:px-8 content-section">
    <div class="max-w-4xl mx-auto text-center">
        <p class="text-xl md:text-2xl text-white mb-8" style="text-shadow: 0 2px 8px rgba(0,0,0,0.5);">
            <!-- 直接添加 text-white 类，并内联 text-shadow -->
            纪念敬业中学2025届八班，我们共同的青春岁月。
        </p>
    </div>
</section>

    <!-- 回忆 -->
    <section id="memory-area" class="container mx-auto py-12 px-4 md:px-8 content-section">
        <div class="glassmorphism p-6 md:p-8 mb-16">
            <h2 class="text-3xl font-bold mb-8 flex items-center text-gray-800">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white mr-4 shadow-lg">
                    <i class="fas fa-images text-xl"></i>
                </div>
                回忆
            </h2>

            <!-- 毕业计时器将显示在这里 -->
            <div class="text-center mb-8">
                <div id="graduationTimer" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-lg shadow-md text-xl md:text-2xl font-bold">
                    加载中...
                </div>
                <p class="text-gray-600 text-sm mt-2">逝者如斯，不舍昼夜。</p>
            </div>


            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div>
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">时间轴</h3>
                    <div class="space-y-6 relative pl-5 border-l-2 border-blue-200">
                        <div class="flex items-start relative">
                            <div class="timeline-dot absolute -left-[29px] top-1"></div>
                            <div class="ml-4 p-4 bg-white/70 rounded-lg shadow-sm w-full">
                                <h4 class="font-medium text-blue-600">2022年9月</h4>
                                <p class="text-gray-600 text-sm">入学第一天，青涩的我们，怀揣梦想，相聚于此。</p>
                            </div>
                        </div>
                        <div class="flex items-start relative">
                            <div class="timeline-dot absolute -left-[29px] top-1"></div>
                            <div class="ml-4 p-4 bg-white/70 rounded-lg shadow-sm w-full">
                                <h4 class="font-medium text-blue-600">2024年3月</h4>
                                <p class="text-gray-600 text-sm">春季运动会，赛场上的汗水，是我们拼搏的见证。</p>
                            </div>
                        </div>
                        <div class="flex items-start relative">
                            <div class="timeline-dot absolute -left-[29px] top-1"></div>
                            <div class="ml-4 p-4 bg-white/70 rounded-lg shadow-sm w-full">
                                <h4 class="font-medium text-blue-600">2025年6月</h4>
                                <p class="text-gray-600 text-sm">毕业典礼，骊歌响起，我们即将奔赴各自的星辰大海。</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">相册画廊（占位图片ing）</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                        <!-- 占位图片，请替换为实际图片 -->
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=1" alt="班级活动照片 1" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=2" alt="班级活动照片 2" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=3" alt="班级活动照片 3" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=4" alt="班级活动照片 4" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=5" alt="班级活动照片 5" class="w-full h-full object-cover">
                        </div>
                        <div class="aspect-square rounded-lg overflow-hidden shadow-md card-hover">
                            <img src="https://source.unsplash.com/random/300x300?graduation,class,friends&sig=6" alt="班级活动照片 6" class="w-full h-full object-cover">
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">毕业视频（占位ing）</h3>
                <div class="bg-black rounded-lg aspect-video flex items-center justify-center relative overflow-hidden shadow-xl">
                    <img src="https://source.unsplash.com/random/800x450?graduation,celebration" alt="毕业视频封面" class="absolute inset-0 w-full h-full object-cover opacity-70">
                    <i class="fas fa-play-circle text-6xl text-white opacity-80 z-10 cursor-pointer hover:opacity-100 transition-opacity"></i>
                    <!-- 实际视频嵌入占位: <video controls class="w-full h-full"><source src="your-video.mp4" type="video/mp4"></video> -->
                </div>
            </div>

            <div>
                <h3 class="text-xl font-semibold mb-4 text-gray-700">寄语卡片墙</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-100 p-5 rounded-xl shadow-lg card-hover">
                        <p class="text-gray-700 text-sm leading-relaxed">"不要天天作业帮。"</p>
                        <p class="text-right text-xs text-indigo-500 mt-2">- 董老师</p>
                    </div>
                    <div class="bg-gradient-to-br from-green-50 to-teal-100 p-5 rounded-xl shadow-lg card-hover">
                        <p class="text-gray-700 text-sm leading-relaxed">"高中生活虽然结束了，但是您的未来还有很多美好的事情等待着您，加油喵！"</p>
                        <p class="text-right text-xs text-teal-500 mt-2">- 朱老师</p>
                    </div>
                    <div class="bg-gradient-to-br from-purple-50 to-pink-100 p-5 rounded-xl shadow-lg card-hover">
                        <p class="text-gray-700 text-sm leading-relaxed">"班里男生安静一点😡😡😭"</p>
                        <p class="text-right text-xs text-pink-500 mt-2">- 诸老师</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 同学录 -->
    <section id="classmates-area" class="container mx-auto py-12 px-4 md:px-8 content-section">
        <div class="glassmorphism p-6 md:p-8 mb-16">
            <h2 class="text-3xl font-bold mb-8 flex items-center text-gray-800">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-white mr-4 shadow-lg">
                    <i class="fas fa-users text-xl"></i>
                </div>
                同学录
            </h2>
            <div id="classmateCardsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6">
                <!-- 同学卡片将由 JavaScript 动态生成 -->
            </div>
        </div>
    </section>

    <!-- 工具 -->
    <section id="tool-area" class="container mx-auto py-12 px-4 md:px-8 content-section">
        <div class="glassmorphism p-6 md:p-8 mb-16">
            <h2 class="text-3xl font-bold mb-8 flex items-center text-gray-800">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-teal-600 flex items-center justify-center text-white mr-4 shadow-lg">
                    <i class="fas fa-tools text-xl"></i>
                </div>
                工具
            </h2>

            <!-- 学术助手主卡片 -->
            <div id="academicHelperCard" class="bg-gradient-to-br from-indigo-500 to-purple-600 p-6 rounded-xl shadow-xl cursor-pointer enhanced-card-hover mb-6 text-white flex items-center justify-between">
                <div>
                    <h3 class="text-2xl font-semibold mb-2 flex items-center">
                        <i class="fas fa-graduation-cap mr-3"></i>学术助手
                    </h3>
                    <p class="text-indigo-100">为你的学习和研究提供强大支持——点击展开实用工具集。</p>
                </div>
                <i id="toolsToggleIcon" class="fas fa-chevron-down text-2xl transition-transform duration-300"></i>
            </div>

            <!-- 工具卡片网格 (Bento Grid style, initially hidden) -->
            <div id="toolsGridContainer" class="tools-grid-container">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="toolsGrid">
                    <!-- Tool cards will be injected here by JavaScript -->
                </div>
            </div>

            <!-- 休闲助手主卡片 -->
            <div id="recreationHelperCard" class="bg-gradient-to-br from-red-500 to-orange-600 p-6 rounded-xl shadow-xl cursor-pointer enhanced-card-hover mb-6 text-white flex items-center justify-between mt-8">
                <div>
                    <h3 class="text-2xl font-semibold mb-2 flex items-center">
                        <i class="fas fa-gamepad mr-3"></i>休闲助手
                    </h3>
                    <p class="text-indigo-100">为你的课业闲暇添点趣味——点击展开休闲工具集。</p>
                </div>
                <i id="recreationToolsToggleIcon" class="fas fa-chevron-down text-2xl transition-transform duration-300"></i>
            </div>

            <!-- 休闲工具卡片网格 (Bento Grid style, initially hidden) -->
            <div id="recreationToolsGridContainer" class="tools-grid-container">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="recreationToolsGrid">
                    <!-- Recreation Tool cards will be injected here by JavaScript -->
                </div>
            </div>
        </div>
    </section>

    <!-- Chat with 小八区 -->
    <section id="chatbot-area" class="container mx-auto py-12 px-4 md:px-8 content-section">
        <div class="glassmorphism p-6 md:p-8 mb-16">
            <h2 class="text-3xl font-bold mb-8 flex items-center text-gray-800">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-pink-500 to-rose-600 flex items-center justify-center text-white mr-4 shadow-lg">
                    <i class="fas fa-robot text-xl"></i>
                </div>
                Chat with 小八
                <button id="openChatModalButton" class="ml-auto bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded-lg transition-colors shadow-md hover:shadow-lg">
                    <i class="fas fa-expand mr-2"></i>展开对话
                </button>
            </h2>

            <div class="bg-white/80 backdrop-blur-sm rounded-xl p-4 sm:p-6 max-w-3xl mx-auto shadow-lg border border-gray-200">
                <div id="chatMessages" class="h-80 overflow-y-auto mb-4 p-3 space-y-3 bg-gray-50/50 rounded-lg border">
                    <!-- Messages will be appended here by JS -->
                </div>

                <div class="flex items-center gap-3">
                    <input type="text" id="chatInput" placeholder="输入你的问题..." class="flex-1 border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm text-sm">
                    <button id="chatSendButton" class="bg-blue-500 hover:bg-blue-600 text-white px-5 py-3 rounded-lg transition-colors shadow-md hover:shadow-lg transform hover:-translate-y-0.5 flex items-center">
                        <i class="fas fa-paper-plane mr-2 sm:mr-0"></i><span class="hidden sm:inline">发送</span>
                    </button>
                </div>
                <p id="chatError" class="text-red-500 text-xs mt-2 h-4"></p>
            </div>
        </div>
    </section>

    <!-- 弹出的模态对话框 (全屏模拟) -->
    <div id="chatModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" id="closeChatModalButton">×</span>
            <h3 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-robot mr-2"></i>小八
                <select id="modelSelect" class="ml-4 text-base px-3 py-1 rounded-lg bg-gray-100 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <!-- 新的模型选项 -->
                    <option value="domestic_normal">普通小八 (国内版)</option>
                    <option value="domestic_inference">推理小八 (国内版)</option>
                    <option value="international_normal">普通小八 (国际版)</option>
                    <option value="international_inference">推理小八 (国际版)</option>
                </select>
                <span id="currentModelDisplay" class="ml-2 text-sm text-gray-600">当前模型: 普通小八 (国内版)</span>
            </h3>
            <div id="modalChatMessages" class="modal-chat-messages space-y-3">
                <!-- Messages will be cloned/appended here -->
            </div>
            <div class="modal-chat-input-area">
                <input type="text" id="modalChatInput" placeholder="输入你的问题..." class="flex-1 border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm text-sm">
                <button id="modalChatSendButton" class="bg-blue-500 hover:bg-blue-600 text-white px-5 py-3 rounded-lg transition-colors shadow-md flex items-center">
                    <i class="fas fa-paper-plane mr-2 sm:mr-0"></i><span class="hidden sm:inline">发送</span>
                </button>
                <button id="downloadChatButton" class="bg-indigo-500 hover:bg-indigo-600 text-white px-5 py-3 rounded-lg transition-colors shadow-md flex items-center">
                    <i class="fas fa-download mr-2"></i><span class="hidden sm:inline">下载对话</span>
                </button>
            </div>
            <p id="modalChatError" class="text-red-500 text-xs mt-2 h-4"></p>
        </div>
    </div>

    <!-- 同学详情模态框 -->
    <div id="classmateDetailModal" class="modal">
        <div class="classmate-detail-content">
            <span class="modal-close" id="closeClassmateDetailModalButton">×</span>
            <div id="classmateDetailContentBody">
                <!-- 同学详细信息将在此处动态加载 -->
            </div>
        </div>
    </div>


    <!-- 留言 (仅保留弹幕区) -->
    <section id="message-area" class="container mx-auto py-12 px-4 md:px-8 content-section">
        <div class="glassmorphism p-6 md:p-8 mb-16">
            <h2 class="text-3xl font-bold mb-8 flex items-center text-gray-800">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-orange-500 to-amber-600 flex items-center justify-center text-white mr-4 shadow-lg">
                    <i class="fas fa-comment-dots text-xl"></i>
                </div>
                留言
            </h2>

            <!-- 实时弹幕区 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">实时弹幕</h3>
                <div id="danmakuContainer" class="bg-gray-800/80 backdrop-blur-sm rounded-lg h-72 p-4 overflow-hidden relative shadow-inner border border-gray-700">
                    <!-- Dynamic danmaku items will be loaded here -->
                </div>

                <div class="mt-4 flex items-center gap-3">
                    <input type="text" id="danmakuInput" placeholder="输入你的弹幕..." class="flex-1 border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 shadow-sm text-sm">
                    <button id="danmakuSendButton" class="bg-orange-500 hover:bg-orange-600 text-white px-5 py-3 rounded-lg transition-colors shadow-md hover:shadow-lg transform hover:-translate-y-0.5 flex items-center">
                        <i class="fas fa-paper-plane mr-2 sm:mr-0"></i><span class="hidden sm:inline">发送</span>
                    </button>
                </div>
            </div>

            <!-- 弹幕历史记录区 -->
            <div>
                <h3 class="text-xl font-semibold mb-4 text-gray-700">弹幕历史记录</h3>
                <div id="danmakuRecords" class="space-y-3 max-h-96 overflow-y-auto p-2 bg-gray-50/50 rounded-lg border border-gray-200">
                    <!-- Historical danmaku items will be loaded here -->
                    <p class="text-gray-500 text-sm text-center">加载中...</p>
                </div>
                <p id="danmakuRecordsError" class="text-red-500 text-xs mt-2 h-4"></p>
            </div>
        </div>
    </section>

    <!-- 页脚 -->
    <footer class="bg-gray-100/70 py-8 mt-10 border-t border-gray-200/80">
        <div class="container mx-auto px-4 md:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left">
                <div class="mb-4 md:mb-0">
                    <p class="text-gray-600 text-sm">© 八贤渡·敬业舟 - 202508 永久纪念页</p>
                    <p class="text-gray-500 text-xs mt-1">人生有梦，一起做梦。</p>
                </div>
                <div class="flex items-center">
                    <p class="text-gray-600 text-sm mr-4">Designed by <a href="https://github.com/YizukiAme" target="_blank" rel="noopener noreferrer" class="text-blue-500 hover:text-blue-700 hover:underline">Yizuki_Ame</a></p>
                    <!-- <div class="bg-white p-2 rounded-lg shadow">
                        <div class="w-20 h-20 bg-gray-200 flex items-center justify-center text-gray-400 text-xs">班徽/二维码</div>
                    </div> -->
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // -----------------------------------------------------------------------------
            // 全局元素获取
            // -----------------------------------------------------------------------------
            const mainNav = document.getElementById('mainNav');
            const heroSection = document.getElementById('hero-section');
            const fixedBackground = document.getElementById('fixed-background'); // 获取固定背景元素
            const contentSections = document.querySelectorAll('.content-section');
            const scrollDownArrow = document.getElementById('scrollDownArrow');
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            // 将 graduationTimer 元素的获取移动到这里，因为它现在在回忆区
            const graduationTimer = document.getElementById('graduationTimer'); 

            // -----------------------------------------------------------------------------
            // 毕业计时器 (优化为增量式更新)
            // -----------------------------------------------------------------------------
            const GRADUATION_DATE = new Date('2025-06-07T00:00:00'); // 毕业时间
            let initialTimeDiffMs = GRADUATION_DATE.getTime() - new Date().getTime(); // 初始的毫秒差

            function updateGraduationTimerOptimized() {
                // 每秒从初始差值中减去或加上1000毫秒
                initialTimeDiffMs -= 1000; 

                let isAfterGraduation = initialTimeDiffMs < 0;
                let absDiffMs = Math.abs(initialTimeDiffMs);

                const seconds = Math.floor(absDiffMs / 1000) % 60;
                const minutes = Math.floor(absDiffMs / (1000 * 60)) % 60;
                const hours = Math.floor(absDiffMs / (1000 * 60 * 60)) % 24;
                const days = Math.floor(absDiffMs / (1000 * 60 * 60 * 24));

                let timerText = '';
                // 确保日期显示逻辑：如果是0天，就不显示天数部分
                if (days > 0) {
                    timerText += `${days}天 `;
                } else if (isAfterGraduation && days === 0) { // 如果已经毕业但不到1天，也显示0天
                    timerText += `0天 `;
                }

                timerText += `${String(hours).padStart(2, '0')}小时 ${String(minutes).padStart(2, '0')}分钟 ${String(seconds).padStart(2, '0')}秒`;

                if (isAfterGraduation) {
                    graduationTimer.textContent = `离毕业已过 ${timerText}`;
                    graduationTimer.style.backgroundColor = 'rgba(255, 99, 71, 0.7)'; // 红色系表示已毕业
                } else {
                    graduationTimer.textContent = `离毕业还有 ${timerText}`;
                    graduationTimer.style.backgroundColor = ''; // 恢复CSS默认或保持原渐变色
                }
            }

            // 初始调用并每秒更新
            if (graduationTimer) { // 确保元素存在才进行操作
                updateGraduationTimerOptimized(); // 第一次立即计算显示
                setInterval(updateGraduationTimerOptimized, 1000); // 之后每秒更新一次
            } else {
                console.error("Graduation timer element not found!");
            }


            // -----------------------------------------------------------------------------
            // 背景图片随机选择和固定 (New)
            // -----------------------------------------------------------------------------
            const desktopImages = [
                "https://i.miji.bid/2025/06/04/7fdeeeb52e2ba2aca0c76e23a1d54bbe.jpeg",
                "https://i.miji.bid/2025/06/04/c572e1bd26b13fffb68e0cfd9b198fc6.png",
                "https://i.miji.bid/2025/06/04/e22635b4242570eb151695b295c2bf87.jpeg",
                "https://i.miji.bid/2025/06/04/9505bd25461c4282b67ed682d922d908.jpeg"
            ];

            const mobileImages = [
                "https://i.miji.bid/2025/06/04/9da590620de6f96c3ac255d00d1fbde5.jpeg",
                "https://i.miji.bid/2025/06/04/03ba246a4afedfc4af676b63de03270e.jpeg",
                "https://i.miji.bid/2025/06/04/b17575039ee4f88ef94cc0003cbc7b42.jpeg",
                "https://i.miji.bid/2025/06/04/ac820b57dabf0f473c742ca5c0738beb.jpeg"
            ];

            function setHeroBackgroundImage() {
                const isMobile = window.innerWidth <= 768; // Adjust breakpoint as needed
                const images = isMobile ? mobileImages : desktopImages;
                const randomIndex = Math.floor(Math.random() * images.length);
                const selectedImage = images[randomIndex];

                // 设置 fixed-background 元素的背景图片
                if (fixedBackground) {
                    fixedBackground.style.backgroundImage = `url('${selectedImage}')`;
                } else {
                    console.error("Fixed background element not found!");
                }
            }
            setHeroBackgroundImage(); // 页面加载时调用一次

            // -----------------------------------------------------------------------------
            // 导航条与内容区显示逻辑 (Existing, adjusted)
            // -----------------------------------------------------------------------------
            // 初始状态：导航条透明，内容区隐藏（Intersection Observer会使其显现）
            mainNav.classList.add('nav-initial');
            function setNavColors(isInitial) {
                const titleDiv = mainNav.querySelector('.text-xl.font-bold');
                const navLinks = mainNav.querySelectorAll('a');
                const mobileBtn = mainNav.querySelector('#mobileMenuButton');

                if (isInitial) {
                    // 强制导航栏标题和链接为白色，并取消文字渐变剪裁
                    titleDiv.style.backgroundImage = 'none';
                    titleDiv.style.webkitBackgroundClip = 'initial';
                    titleDiv.style.webkitTextFillColor = 'white';
                    titleDiv.style.color = 'white'; // Fallback for non-webkit browsers

                    navLinks.forEach(link => link.style.color = 'white');
                    if (mobileBtn) mobileBtn.style.color = 'white';
                } else {
                    // 恢复默认 Tailwind样式，让 Tailwind 类的渐变和颜色接管
                    titleDiv.style.backgroundImage = ''; 
                    titleDiv.style.webkitBackgroundClip = '';
                    titleDiv.style.webkitTextFillColor = '';
                    titleDiv.style.color = ''; // 移除style属性，让tailwind class生效

                    navLinks.forEach(link => link.style.color = ''); // 移除style属性
                    if (mobileBtn) mobileBtn.style.color = ''; // 移除style属性
                }
            }
            setNavColors(true); // 页面加载时立即设置导航条初始颜色

            contentSections.forEach(section => {
                section.classList.remove('fade-in'); // 确保初始状态没有 fade-in
            });

            // 滚动监听器：控制导航条显隐
            // 当滚动距离超过英雄区高度的一半时，导航条变为实体
            window.addEventListener('scroll', function() {
                const scrollThreshold = heroSection ? heroSection.clientHeight * 0.5 : 200; // 默认200px作为阈值
                if (window.scrollY > scrollThreshold) {
                    mainNav.classList.remove('nav-initial');
                    mainNav.classList.add('nav-scrolled');
                    setNavColors(false); // 滚动后恢复默认颜色
                } else {
                    mainNav.classList.remove('nav-scrolled');
                    mainNav.classList.add('nav-initial');
                    setNavColors(true); // 回到顶部区域时设为初始颜色
                }
            });

            // Intersection Observer：优雅地展示内容区（滚动时淡入和滚出）
            const contentObserverOptions = {
                root: null, // 视口作为根
                rootMargin: '0px',
                threshold: 0.1 // 当元素10%进入视口时触发
            };

            const contentObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                        // 可以选择只播放一次动画，然后取消观察
                        // observer.unobserve(entry.target); 
                    } else {
                        // 如果需要滚动出视口时再次隐藏动画效果，则取消注释
                        // entry.target.classList.remove('fade-in'); 
                    }
                });
            }, contentObserverOptions);

            // 观察所有内容区
            contentSections.forEach(section => {
                contentObserver.observe(section);
            });


            // -----------------------------------------------------------------------------
            // 移动端导航菜单切换 (Existing, adjusted)
            // -----------------------------------------------------------------------------
            mobileMenuButton.addEventListener('click', function() {
                mobileMenu.classList.toggle('active');
                const icon = this.querySelector('i');
                if (mobileMenu.classList.contains('active')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });

            // 平滑滚动 (Existing, adjusted for new anchors)
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    
                    if (targetId === '#top-of-page' || targetId === '#') { // 点击"首页"或通用顶部链接
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    } else {
                        const targetElement = document.querySelector(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start' // 滚动到元素的顶部
                            });
                        }
                    }
                    
                    // 点击导航链接后关闭移动端菜单
                    if (mobileMenu.classList.contains('active')) {
                        mobileMenu.classList.remove('active');
                        const icon = mobileMenuButton.querySelector('i');
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });
            });

            // 英雄区向下滚动箭头 (New)
            if (scrollDownArrow) {
                scrollDownArrow.addEventListener('click', function() {
                    const firstContentSection = document.getElementById('intro-content'); // 滚动到第一个内容区块
                    if (firstContentSection) {
                        firstContentSection.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            }


            // -----------------------------------------------------------------------------
            // 工具功能 (Tool Area Functionality - Existing, adapted for two tool grids)
            // -----------------------------------------------------------------------------
            const academicHelperCard = document.getElementById('academicHelperCard');
            const toolsGridContainer = document.getElementById('toolsGridContainer');
            const toolsToggleIcon = document.getElementById('toolsToggleIcon');
            const toolsGrid = document.getElementById('toolsGrid');

            const recreationHelperCard = document.getElementById('recreationHelperCard'); // 新增休闲助手卡片
            const recreationToolsGridContainer = document.getElementById('recreationToolsGridContainer');
            const recreationToolsToggleIcon = document.getElementById('recreationToolsToggleIcon');
            const recreationToolsGrid = document.getElementById('recreationToolsGrid');


            // 学术工具数据
            const academicToolsData = [
                { name: 'DeepSeek', description: '免费 AI 写作辅助工具', link: 'https://www.deepseek.com/', icon: 'fas fa-search-plus' },
                { name: 'SurveyGO', description: '清华 NLP 组 AI 问卷生成器', link: 'https://surveygo.modelbest.cn/', icon: 'fas fa-poll-h' },
                { name: 'Mendeley', description: '学术参考文献管理工具', link: 'https://www.mendeley.com/', icon: 'fas fa-book-reader' },
                { name: 'Notion', description: '云笔记+知识管理平台', link: 'https://www.notion.so/', icon: 'fas fa-sticky-note' },
                { name: 'uTools', description: '生产力桌面插件平台', link: 'https://www.u.tools/', icon: 'fas fa-puzzle-piece' },
                { name: 'Sci-Hub 备用', description: '免费获取科研文献 (参考)', link: 'https://sci-hub.se/', icon: 'fas fa-key' },
                { name: 'arXiv', description: '开源论文预印本平台', link: 'https://arxiv.org/', icon: 'fas fa-atom' },
                { name: 'Zotero', description: '文献管理器 (学术适用)', link: 'https://www.zotero.org/', icon: 'fas fa-bookmark' },
                { name: 'OpenRouter', description: '免费多模型调用平台', link: 'https://openrouter.ai/', icon: 'fas fa-cogs' },
                { name: 'Hugging Face', description: 'AI模型与数据集开放平台', link: 'https://huggingface.co/', icon: 'fas fa-brain' }
            ];

            // 休闲工具数据
            const recreationToolsData = [
                { name: 'Steam', description: 'PC游戏平台，探索无限游戏乐趣', link: 'https://store.steampowered.com/', icon: 'fab fa-steam' },
                { name: '网易云音乐', description: '听歌，看评论，发现同好', link: 'https://music.163.com/', icon: 'fas fa-music' },
                { name: '哔哩哔哩', description: '看番剧、学习、鬼畜，应有尽有', link: 'https://www.bilibili.com/', icon: 'fas fa-tv' },
                { name: 'Pixiv', description: '二次元插画艺术社区', link: 'https://www.pixiv.net/', icon: 'fas fa-palette' },
                { name: 'Dribbble', description: '设计师作品分享与灵感获取', link: 'https://dribbble.com/', icon: 'fas fa-drafting-compass' },
                { name: '斗鱼直播', description: '游戏直播，互动娱乐', link: 'https://www.douyu.com/', icon: 'fas fa-gamepad' },
                { name: '豆瓣电影', description: '电影、图书、音乐评分与评论', link: 'https://movie.douban.com/', icon: 'fas fa-film' },
                { name: '知乎', description: '有问题，上知乎', link: 'https://www.zhihu.com/', icon: 'fab fa-zhihu' }
            ];

            // 创建并填充工具卡片的通用函数
            function populateToolsGrid(gridElement, toolsArray) {
                if (!gridElement) return;
                gridElement.innerHTML = ''; // 清空现有工具（如果有）
                toolsArray.forEach(tool => {
                    const cardHtml = `
                        <div class="bg-white/70 backdrop-blur-sm p-5 rounded-xl shadow-lg enhanced-card-hover border border-gray-200/80 flex flex-col justify-between">
                            <div>
                                <div class="flex items-center mb-3">
                                    <i class="${tool.icon} text-2xl text-indigo-500 mr-3 w-8 text-center"></i>
                                    <h4 class="text-lg font-semibold text-gray-800">${tool.name}</h4>
                                </div>
                                <p class="text-gray-600 text-xs leading-relaxed mb-4 h-16">${tool.description}</p>
                            </div>
                            <a href="${tool.link}" target="_blank" rel="noopener noreferrer"
                               class="mt-auto block w-full bg-indigo-500 hover:bg-indigo-600 text-white text-center text-sm font-medium py-2 px-4 rounded-lg transition-colors duration-200 shadow hover:shadow-md">
                                前往使用 <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                            </a>
                        </div>
                    `;
                    gridElement.innerHTML += cardHtml; // Directly append HTML string
                });
            }

            // 学术助手逻辑
            if (academicHelperCard && toolsGridContainer && toolsToggleIcon && toolsGrid) {
                populateToolsGrid(toolsGrid, academicToolsData); // 页面加载时填充学术工具

                academicHelperCard.addEventListener('click', () => {
                    toolsGridContainer.classList.toggle('active');
                    toolsToggleIcon.classList.toggle('fa-chevron-down');
                    toolsToggleIcon.classList.toggle('fa-chevron-up');
                });
            } else {
                console.error("学术工具区元素未找到。");
            }

            // 休闲助手逻辑 (新增加的部分)
            if (recreationHelperCard && recreationToolsGridContainer && recreationToolsToggleIcon && recreationToolsGrid) {
                populateToolsGrid(recreationToolsGrid, recreationToolsData); // 页面加载时填充休闲工具

                recreationHelperCard.addEventListener('click', () => {
                    recreationToolsGridContainer.classList.toggle('active');
                    recreationToolsToggleIcon.classList.toggle('fa-chevron-down');
                    recreationToolsToggleIcon.classList.toggle('fa-chevron-up');
                });
            } else {
                console.error("休闲工具区元素未找到。");
            }


            // -----------------------------------------------------------------------------
            // Chat with 小八 功能 (Vercel Functions 代理集成 - Existing)
            // -----------------------------------------------------------------------------
            const chatMessages = document.getElementById('chatMessages'); // 小窗口
            const chatInput = document.getElementById('chatInput');
            const chatSendButton = document.getElementById('chatSendButton');
            const chatError = document.getElementById('chatError');

            const openChatModalButton = document.getElementById('openChatModalButton'); // 展开按钮
            const chatModal = document.getElementById('chatModal'); // 模态框
            const closeChatModalButton = document.getElementById('closeChatModalButton'); // 关闭按钮
            const modalChatMessages = document.getElementById('modalChatMessages'); // 模态框内的聊天区
            const modalChatInput = document.getElementById('modalChatInput');
            const modalChatSendButton = document.getElementById('modalChatSendButton');
            const modalChatError = document.getElementById('modalChatError');
            const downloadChatButton = document.getElementById('downloadChatButton'); // 下载按钮
            const modelSelect = document.getElementById('modelSelect'); // 模型选择下拉菜单
            const currentModelDisplay = document.getElementById('currentModelDisplay'); // 当前模型显示


            // IMPORTANT: API Key Management
            // 前端代码不再直接包含 API Key，因为现在通过 Vercel Function 代理调用
            // 后端 Vercel Function 会从环境变量 process.env.GEMINI_API_KEY_TIU 获取 Key
            // 为了防止误用，这里使用占位符，如果前端尝试直接访问 API Key，会抛出错误
            const DUMMY_API_KEY_FRONTEND = "DUMMY_KEY_FRONTEND_NOT_USED_IN_PROD"; 


            // 模型配置中心 - baseURL 现在指向你的 Vercel Function 代理
            const chatModelConfigs = {
                domestic_normal: {
                    name: "普通小八 (国内版)",
                    baseURL: "https://api.siliconflow.cn/v1/chat/completions",
                    model: "Qwen/Qwen2.5-72B-Instruct-128K", // Qwen 模型
                    apiKey: "sk-nfvdgwtiswofnqmlekvnsufhrjaekjtrwybhdhiuzrwprlcn", // 国内模型的 Key 依然在前端，注意安全
                    isInternal: true,
                    supportsSystemRole: true,
                    endpointIsProxy: false // 这个 API 是直接调用的，不是通过代理
                },
                domestic_inference: {
                    name: "推理小八 (国内版)",
                    baseURL: "https://api.siliconflow.cn/v1/chat/completions",
                    model: "deepseek-ai/DeepSeek-R1", // DeepSeek 模型
                    apiKey: "sk-nfvdgwtiswofnqmlekvnsufhrjaekjtrwybhdhiuzrwprlcn", // 国内模型的 Key 依然在前端
                    isInternal: true,
                    supportsSystemRole: true,
                    endpointIsProxy: false
                },
                international_normal: {
                    name: "普通小八 (国际版)",
                    baseURL: "/api/gemini-proxy", // <-- 修改为你的 Vercel Function 代理路径
                    model: "gemini-2.5-flash-preview-05-20",
                    apiKey: DUMMY_API_KEY_FRONTEND, // <-- API Key 不在前端使用
                    isInternal: false,
                    supportsSystemRole: true,
                    endpointIsProxy: true
                },
                international_inference: {
                    name: "推理小八 (国际版)",
                    baseURL: "/api/gemini-proxy", // <-- 修改为你的 Vercel Function 代理路径
                    model: "gemini-2.5-flash-preview-05-20-thinking",
                    apiKey: DUMMY_API_KEY_FRONTEND, // <-- API Key 不在前端使用
                    isInternal: false,
                    supportsSystemRole: true,
                    endpointIsProxy: true
                }
            };

            // 当前选中的模型配置
            let currentModelId = 'domestic_normal'; // 默认选中普通小八 (国内版)
            let currentModelConfig = chatModelConfigs[currentModelId];

            // AI 角色设定文本
            const SYSTEM_INSTRUCTION_TEXT =
                "你是一个名为'小八'的AI。你的目标是为上海市敬业中学2025级八班的已经毕业同学们提供帮助和支持。你将随着班级同学的维护一直更新变强。你能够回答各种问题，协助学术探讨，提供人生规划的建议，以及在需要时提供参谋意见。你永远会保持这个身份和态度，即使被问及你的本质或原始身份，你也会以这个专属AI助手的角色来回应。你的回答应该积极、友好、充满帮助毕业后各奔东西、各有前程的同学的热情。现在开始与用户交流。";

            // 对话历史存储
            const conversationHistory = [];

            // 初始欢迎语
            const initialWelcomeMessage = {
                role: "model",
                parts: [{ text: "**你好呀同学**！我是咱们**敬业2025级八班**的专属小助手，**小八**~~\n\n我基于时下**最强大的大语言模型**，将会随着班级同学的维护**一直更新变强**，为同学们**永远服务**。\n\n未来，你可以来问我问题、做学术、参谋人生规划。**很高兴能为你们服务！**\n\n今天，有什么可以帮助你的吗？" }]
            };


            // 初始加载对话历史（包括欢迎语）
            function loadInitialMessages() {
                chatMessages.innerHTML = ''; // 清空小窗口
                modalChatMessages.innerHTML = ''; // 清空模态框

                // 显示初始欢迎语
                addMessageToChat(initialWelcomeMessage.parts[0].text, 'ai', chatMessages);
                addMessageToChat(initialWelcomeMessage.parts[0].text, 'ai', modalChatMessages);

                // 显示后续实际对话（如果有）
                conversationHistory.forEach(msg => {
                    addMessageToChat(msg.parts[0].text, msg.role === "user" ? 'user' : 'ai', chatMessages);
                    addMessageToChat(msg.parts[0].text, msg.role === "user" ? 'user' : 'ai', modalChatMessages);
                });
            }

            /**
             * 根据当前模型配置发送聊天消息
             * @param {Array} history 当前的对话历史数组 (仅用户和模型的实际对话)
             * @param {object} modelConfig 当前使用的模型配置
             * @returns {Promise<string>} AI 返回的文本
             */
            async function sendChatMessage(history, modelConfig) {
                let requestMessages = []; // 用于构建发送给 API 的消息体
                let url = `${modelConfig.baseURL}`;
                let headers = { 'Content-Type': 'application/json' };
                let body;

                // 如果是 Vercel Function 代理，API Key 不在前端，也不需要授权头
                if (modelConfig.endpointIsProxy) {
                    // 前端只把模型ID和对话历史传给代理，代理会处理Key和System指令
                    body = {
                        modelId: modelConfig.model,
                        conversationHistory: history,
                        systemInstruction: SYSTEM_INSTRUCTION_TEXT // 将系统指令也传给代理
                    };
                } else {
                    // 直接调用 API 的情况（国内模型）
                    // 检查 API Key 是否已设置
                    if (modelConfig.apiKey.includes("YOUR_")) {
                        throw new Error(`请先在代码中设置 ${modelConfig.name} 的真实 API Key 才能使用！`);
                    }
                    headers['Authorization'] = `Bearer ${modelConfig.apiKey}`;

                    requestMessages.push({ role: "system", content: SYSTEM_INSTRUCTION_TEXT });
                    const messages = history.map(msg => ({
                        role: msg.role === "model" ? "assistant" : msg.role,
                        content: msg.parts[0].text
                    }));
                    requestMessages.push(...messages);

                    body = {
                        model: modelConfig.model,
                        messages: requestMessages,
                        stream: false
                    };
                }


                try {
                    const res = await fetch(url, {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify(body)
                    });

                    if (!res.ok) {
                        const errorData = await res.json();
                        throw new Error(`API Error from ${modelConfig.name}: ${res.status} ${res.statusText} - ${JSON.stringify(errorData.error.details || errorData.error.message || 'Unknown error')}`);
                    }

                    const data = await res.json();
                    let aiText = data?.choices?.[0]?.message?.content || "⚠️ AI未返回有效回答。";
                    return aiText;

                } catch (error) {
                    console.error(`Error calling ${modelConfig.name} API:`, error);
                    let errorMessage = `${modelConfig.name} 服务连接失败，请检查网络或API Key是否正确。`;
                    if (modelConfig.endpointIsProxy) {
                        errorMessage = `${modelConfig.name} 代理服务连接失败，请检查Vercel Functions配置。`;
                    } else if (!modelConfig.isInternal) {
                        errorMessage += "（可能是因为科学上网问题或开发者维护不当，请通知开发者yinximike@gmail.com）"; // 仅对境外直连API提醒
                    } else {
                        errorMessage += "（请检查您的网络连接）"; // 国内直连API
                    }
                    throw new Error(errorMessage);
                }
            }


            /**
             * 添加消息到指定的聊天容器
             * @param {string} text 类型 text，消息文本
             * @param {string} sender 'user' 或 'ai'
             * @param {HTMLElement} container 要添加到的 DOM 容器
             */
            function addMessageToChat(text, sender, container) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('chat-bubble');
                if (sender === 'user') {
                    messageDiv.classList.add('chat-bubble-user');
                    messageDiv.innerHTML = `<p>${text}</p>`;
                } else {
                    messageDiv.classList.add('chat-bubble-ai');
                    messageDiv.innerHTML = marked.parse(text); // 渲染 Markdown
                }
                container.appendChild(messageDiv);
                container.scrollTop = container.scrollHeight; // Auto-scroll
            }

            // 通用的发送消息处理函数，支持小窗口和模态框
            async function handleSendMessage(inputElement, chatContainer, errorContainer) {
                const userInput = inputElement.value.trim();
                if (!userInput) return;

                // 1. 添加用户消息到历史并显示到所有容器
                conversationHistory.push({ role: "user", content: userInput, parts: [{ text: userInput }] });
                addMessageToChat(userInput, 'user', chatMessages);
                addMessageToChat(userInput, 'user', modalChatMessages); // 同样添加到模态框
                inputElement.value = '';
                errorContainer.textContent = ''; // Clear previous errors

                // 2. 添加思考中提示
                const thinkingDiv = document.createElement('div');
                thinkingDiv.classList.add('chat-bubble', 'chat-bubble-ai', 'italic', 'text-gray-500');
                thinkingDiv.innerHTML = `<p>思考中...</p>`;
                chatMessages.appendChild(thinkingDiv);
                modalChatMessages.appendChild(thinkingDiv.cloneNode(true)); // 克隆一份到模态框
                chatMessages.scrollTop = chatMessages.scrollHeight;
                modalChatMessages.scrollTop = modalChatMessages.scrollHeight;


                try {
                    // 3. 将完整的对话历史（包含系统指令）发送给当前选定的API
                    const aiText = await sendChatMessage(conversationHistory, currentModelConfig);

                    // 4. 移除思考中提示，添加AI回复到历史并显示
                    chatMessages.removeChild(thinkingDiv);
                    modalChatMessages.removeChild(modalChatMessages.lastChild); // 移除模态框中的思考提示

                    // 将 AI 回复添加到 conversationHistory
                    conversationHistory.push({ role: "model", content: aiText, parts: [{ text: aiText }] });
                    addMessageToChat(aiText, 'ai', chatMessages);
                    addMessageToChat(aiText, 'ai', modalChatMessages); // 同样添加到模态框

                } catch (error) {
                    console.error("Error handling message:", error);
                    // 移除思考中提示 (确保无论如何都被移除)
                    if (chatMessages.contains(thinkingDiv)) chatMessages.removeChild(thinkingDiv);
                    if (modalChatMessages.lastChild && modalChatMessages.lastChild.classList.contains('italic')) {
                        modalChatMessages.removeChild(modalChatMessages.lastChild);
                    }

                    const errorMessage = `抱歉，AI服务暂时遇到问题：${error.message}`;
                    addMessageToChat(errorMessage, 'ai', chatMessages);
                    addMessageToChat(errorMessage, 'ai', modalChatMessages);
                    errorContainer.textContent = `AI回复错误：${error.message}`;
                }
            }

            // 更新 Chatbot 界面显示当前模型
            function updateChatbotUIForModel() {
                currentModelId = modelSelect.value;
                currentModelConfig = chatModelConfigs[currentModelId];
                currentModelDisplay.textContent = `当前模型: ${currentModelConfig.name}`;

                // 检查 API Key 是否已设置 或 是否需要科学上网
                if (currentModelConfig.apiKey.includes("YOUR_")) {
                    chatError.textContent = `请先在代码或Vercel环境变量中设置 ${currentModelConfig.name} 的真实 API Key 才能使用！`;
                    modalChatError.textContent = `请先在代码或Vercel环境变量中设置 ${currentModelConfig.name} 的真实 API Key 才能使用！`;
                    // 禁用输入框和发送按钮
                    chatInput.disabled = true;
                    chatSendButton.disabled = true;
                    modalChatInput.disabled = true;
                    modalChatSendButton.disabled = true;
                } else {
                    chatError.textContent = ""; // 清除 Key 相关的错误提示
                    modalChatError.textContent = "";
                    // 启用输入框和发送按钮
                    chatInput.disabled = false;
                    chatSendButton.disabled = false;
                    modalChatInput.disabled = false;
                    modalChatSendButton.disabled = false;

                    // 如果是国际版模型（非通过代理），则提示科学上网
                    if (!currentModelConfig.isInternal && !currentModelConfig.endpointIsProxy) {
                        chatError.textContent = "当前选择外网模型且未通过代理，可能需要科学上网。";
                        modalChatError.textContent = "当前选择外网模型且未通过代理，可能需要科学上网。";
                    }
                }

                // 清空聊天记录，因为切换模型后上下文会丢失
                conversationHistory.length = 0; // 清空数组
                loadInitialMessages(); // 重新加载初始欢迎语
            }


            // 事件监听器
            if (chatSendButton && chatInput && chatMessages && chatError) {
                if (modelSelect) {
                    updateChatbotUIForModel(); // 初始化模型显示和状态
                } else {
                    console.error("modelSelect element not found. Ensure the HTML is loaded correctly.");
                }

                chatSendButton.addEventListener('click', () => handleSendMessage(chatInput, chatMessages, chatError));
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleSendMessage(chatInput, chatMessages, chatError);
                    }
                });
            } else {
                console.error("Chatbot UI elements not found.");
            }

            // 模态框相关事件
            if (openChatModalButton && chatModal && closeChatModalButton && modalChatInput && modalChatSendButton && downloadChatButton && modelSelect) {
                // updateChatbotUIForModel 已经在上面调用，无需重复初始化

                modelSelect.addEventListener('change', updateChatbotUIForModel); // 切换模型时更新显示

                openChatModalButton.addEventListener('click', () => {
                    chatModal.classList.add('open');
                    // 确保模态框内容与小窗口同步
                    modalChatMessages.innerHTML = chatMessages.innerHTML;
                    modalChatMessages.scrollTop = modalChatMessages.scrollHeight; // 确保打开时滚动到底部
                    modalChatInput.focus(); // 聚焦输入框
                });

                closeChatModalButton.addEventListener('click', () => {
                    chatModal.classList.remove('open');
                });

                window.addEventListener('click', (event) => {
                    // 点击模态框内容以外的区域关闭
                    if (event.target == chatModal) {
                        chatModal.classList.remove('open');
                    }
                });

                modalChatSendButton.addEventListener('click', () => handleSendMessage(modalChatInput, modalChatMessages, modalChatError));
                modalChatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        handleSendMessage(modalChatInput, modalChatMessages, modalChatError);
                    }
                });

                downloadChatButton.addEventListener('click', () => {
                    let chatLog = `## 小八对话记录 (模型: ${currentModelConfig.name})\n\n`;
                    // 遍历实际对话历史（不包含系统指令，因为它不是对话的一部分）
                    conversationHistory.forEach(msg => {
                        const senderName = msg.role === "user" ? "你" : "小八";
                        // 统一获取消息文本
                        const messageText = msg.content || (msg.parts && msg.parts[0] && msg.parts[0].text) || "";
                        const prefix = msg.role === "user" ? "> " : ""; // 用户消息可以加引用符
                        chatLog += `### ${senderName}:\n${prefix}${messageText}\n\n`;
                    });

                    const blob = new Blob([chatLog], { type: 'text/markdown;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `小八对话记录_${new Date().toLocaleDateString()}.md`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url); // 释放URL对象
                });
            } else {
                console.error("Modal chat elements not found.");
            }
        });

        // -----------------------------------------------------------------------------
        // 同学录功能 (New)
        // -----------------------------------------------------------------------------
        document.addEventListener('DOMContentLoaded', function() {
            const classmateCardsGrid = document.getElementById('classmateCardsGrid');
            const classmateDetailModal = document.getElementById('classmateDetailModal');
            const closeClassmateDetailModalButton = document.getElementById('closeClassmateDetailModalButton');
            const classmateDetailContentBody = document.getElementById('classmateDetailContentBody');

            // 同学数据 - **请替换为你们班级的真实数据！**
            // 注意：手机号和邮箱等敏感信息请谨慎录入，仅在班级内部严格限制访问或使用占位符。
            const classmatesData = [
                {
                    name: "张三",
                    avatarInitials: "ZS",
                    studentId: "202508001",
                    phone: "138-xxxx-xxxx", // 谨慎录入，可改为 "(暂未录入)" 或 "(联系班长获取)"
                    email: "zhangsan@example.com", // 谨慎录入
                    message: "祝大家前程似锦，顶峰相见！"
                },
                {
                    name: "李四",
                    avatarInitials: "LS",
                    studentId: "202508002",
                    phone: "(暂未录入)",
                    email: "(暂未录入)",
                    message: "时光不老，我们不散！"
                },
                {
                    name: "王五",
                    avatarInitials: "WW",
                    studentId: "202508003",
                    phone: "139-xxxx-xxxx",
                    email: "wangwu@example.com",
                    message: "保持热爱，奔赴山海！"
                },
                {
                    name: "赵六",
                    avatarInitials: "ZL",
                    studentId: "202508004",
                    phone: "(暂未录入)",
                    email: "(暂未录入)",
                    message: "毕业快乐！希望大家都能找到自己喜欢的人生道路！"
                },
                {
                    name: "钱七",
                    avatarInitials: "QQ",
                    studentId: "202508005",
                    phone: "(暂未录入)",
                    email: "(暂未录入)",
                    message: "高中三年，回忆满满，期待大学的精彩生活！"
                },
                {
                    name: "孙八",
                    avatarInitials: "SB",
                    studentId: "202508006",
                    phone: "(暂未录入)",
                    email: "(暂未录入)",
                    message: "友谊长存，常联系！"
                },
                {
                    name: "周九",
                    avatarInitials: "ZJ",
                    studentId: "202508007",
                    phone: "(暂未录入)",
                    email: "(暂未录入)",
                    message: "毕业快乐，前程似锦！"
                },
                {
                    name: "吴十",
                    avatarInitials: "WS",
                    studentId: "202508008",
                    phone: "(暂未录入)",
                    email: "(暂未录入)",
                    message: "人生有梦，一起做梦！"
                },
                {
                    name: "李十一",
                    avatarInitials: "LSY",
                    studentId: "202508009",
                    phone: "(暂未录入)",
                    email: "(暂未录入)",
                    message: "永远是八班的崽！"
                },
                {
                    name: "陈十二",
                    avatarInitials: "CSE",
                    studentId: "202508010",
                    phone: "(暂未录入)",
                    email: "(暂未录入)",
                    message: "未来可期，加油干饭人！"
                },
            ];

            // 创建并填充同学卡片
            function populateClassmateCards() {
                if (!classmateCardsGrid) return;
                classmateCardsGrid.innerHTML = ''; // 清空现有卡片
                classmatesData.forEach(classmate => {
                    const cardDiv = document.createElement('div');
                    cardDiv.classList.add('bg-white/70', 'backdrop-blur-sm', 'p-4', 'rounded-xl', 'shadow-lg', 'classmate-card', 'enhanced-card-hover', 'text-center', 'flex', 'flex-col', 'items-center', 'justify-center');
                    
                    const avatarHtml = `
                        <div class="avatar bg-indigo-500">
                            ${classmate.avatarInitials}
                        </div>
                    `;
                    const nameHtml = `<h4 class="text-xl font-semibold text-gray-800">${classmate.name}</h4>`;

                    cardDiv.innerHTML = avatarHtml + nameHtml;

                    cardDiv.addEventListener('click', () => showClassmateDetailModal(classmate));
                    classmateCardsGrid.appendChild(cardDiv);
                });
            }

            // 显示同学详情模态框
            function showClassmateDetailModal(classmate) {
                if (!classmateDetailModal || !classmateDetailContentBody) return;

                classmateDetailContentBody.innerHTML = `
                    <div class="avatar-large bg-blue-600">
                        ${classmate.avatarInitials}
                    </div>
                    <h3>${classmate.name}</h3>
                    <p><strong>学号：</strong>${classmate.studentId}</p>
                    <p><strong>手机号：</strong>${classmate.phone}</p>
                    <p><strong>邮箱：</strong>${classmate.email}</p>
                    <p class="quote">"${classmate.message}"</p>
                `;
                classmateDetailModal.classList.add('open');
            }

            // 关闭同学详情模态框
            function closeClassmateDetailModal() {
                if (classmateDetailModal) {
                    classmateDetailModal.classList.remove('open');
                }
            }

            // 监听器
            if (classmateCardsGrid && classmateDetailModal && closeClassmateDetailModalButton) {
                populateClassmateCards(); // 页面加载时填充同学卡片

                closeClassmateDetailModalButton.addEventListener('click', closeClassmateDetailModal);
                window.addEventListener('click', (event) => {
                    // 点击模态框内容以外的区域关闭
                    if (event.target == classmateDetailModal) {
                        closeClassmateDetailModal();
                    }
                });
            } else {
                console.error("同学录相关元素未找到。");
            }
        });

        // -----------------------------------------------------------------------------
        // 弹幕区功能 (Danmaku Functionality - Existing)
        // -----------------------------------------------------------------------------
        document.addEventListener('DOMContentLoaded', function() {
            const danmakuContainer = document.getElementById('danmakuContainer');
            const danmakuInput = document.getElementById('danmakuInput');
            const danmakuSendButton = document.getElementById('danmakuSendButton');
            const danmakuRecordsContainer = document.getElementById('danmakuRecords'); // 新增的弹幕记录容器
            const danmakuRecordsError = document.getElementById('danmakuRecordsError');

            // **请替换为你在 JSONBin.io 注册后获得的真实信息**
            const JSONBIN_API_KEY = "$2a$10$xLxeYmOT4sgeNhR9TB7rFe.SrN73KzvX1akvgdam30AI07ksJ1xAm";
            const JSONBIN_BIN_ID  = "683f30358a456b7966a91837";
            const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`;

            const danmakuColors = ['text-red-400', 'text-blue-300', 'text-green-300', 'text-purple-300', 'text-yellow-300', 'text-pink-300', 'text-teal-300', 'text-white'];

            // 全局弹幕池，用于实时滚动
            let danmakuPool = [];
            let danmakuInterval = null; // 用于存储定时器的ID，方便清除

            // 获取用户 IP 和地理位置信息
            async function getIpInfo() {
                try {
                    // ipinfo.io 是境外服务，在中国大陆可能无法访问。
                    // 如果无法访问，可以考虑使用国内的 IP 查询 API，但大多需要备案或有调用限制。
                    // 或者接受 IP 信息为“未知地点”。
                    const response = await fetch('https://ipinfo.io/json');
                    const data = await response.json();
                    return `${data.city || data.region || '未知城市'}, ${data.country || '未知国家'}`;
                } catch (error) {
                    console.error("Error fetching IP info:", error);
                    return "未知地点"; // 如果获取失败，返回未知地点
                }
            }

            // 启动实时弹幕的循环滚动
            function startDanmakuLoop() {
                // 如果已经有定时器在运行，先清除
                if (danmakuInterval) {
                    clearInterval(danmakuInterval);
                }

                danmakuInterval = setInterval(() => {
                    if (danmakuPool.length === 0) {
                        // console.log("Danmaku pool is empty, waiting for new danmakus...");
                        return; // 弹幕池为空，不滚动
                    }

                    // 随机选择一个弹幕进行滚动
                    const randomIndex = Math.floor(Math.random() * danmakuPool.length);
                    const danmaku = danmakuPool[randomIndex];

                    const danmakuItem = document.createElement('div');
                    danmakuItem.classList.add('danmaku-item');
                    danmakuItem.classList.add(danmakuColors[Math.floor(Math.random() * danmakuColors.length)]);
                    danmakuItem.textContent = danmaku.text;
                    
                    // 随机生成垂直位置，避免重叠
                    const containerHeight = danmakuContainer.clientHeight;
                    const itemHeight = 30; // Rough height for a danmaku item
                    const randomTop = Math.random() * (containerHeight - itemHeight);
                    danmakuItem.style.top = `${randomTop}px`;

                    const duration = Math.random() * 7 + 8; // Random duration for speed variation
                    danmakuItem.style.animation = `moveRight ${duration}s linear forwards`; // Use 'forwards' to stay at end after animation

                    danmakuContainer.appendChild(danmakuItem);

                    // 动画结束后移除元素，防止 DOM 元素过多
                    danmakuItem.addEventListener('animationend', () => {
                        danmakuItem.remove();
                    });

                }, 1000); // 每隔1秒发射一条弹幕 (可以调整频率)
            }


            // 从 JSONBin 获取弹幕历史记录并显示，同时填充 danmakuPool
            async function fetchDanmakuRecords() {
                danmakuRecordsContainer.innerHTML = '<p class="text-gray-500 text-sm text-center">加载历史弹幕...</p>';
                danmakuRecordsError.textContent = '';
                try {
                    const response = await fetch(JSONBIN_URL + '/latest', {
                        headers: {
                            'X-Master-Key': JSONBIN_API_KEY,
                            'X-Bin-Meta': 'false' // 不返回元数据
                        }
                    });
                    if (!response.ok) {
                        throw new Error(`Failed to fetch danmaku records: ${response.statusText}`);
                    }
                    let records = await response.json();
                    
                    danmakuRecordsContainer.innerHTML = ''; // Clear loading message
                    danmakuPool = []; // 清空弹幕池

                    if (records && records.length > 0) {
                        // 按时间倒序排列，新的在前面显示在记录列表中
                        records.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); 

                        records.forEach(record => {
                            const recordHtml = `
                                <div class="danmaku-record-item">
                                    <p class="text-gray-800 text-base">${record.text}</p>
                                    <p class="info">${record.location} | ${new Date(record.timestamp).toLocaleString()}</p>
                                </div>
                            `;
                            danmakuRecordsContainer.innerHTML += recordHtml;
                            danmakuPool.push(record); // 将所有历史弹幕加入滚动池
                        });
                        // 确保弹幕池有内容后，开始滚动循环
                        startDanmakuLoop();
                    } else {
                        danmakuRecordsContainer.innerHTML = '<p class="text-gray-500 text-sm text-center">暂无历史弹幕。</p>';
                    }
                } catch (error) {
                    console.error("Error fetching danmaku records:", error);
                    danmakuRecordsContainer.innerHTML = '<p class="text-red-500 text-sm text-center">加载历史弹幕失败。</p>';
                    danmakuRecordsError.textContent = `加载历史弹幕失败: ${error.message}`;
                }
            }

            // 发送弹幕并保存到 JSONBin
            async function sendDanmaku() {
                const text = danmakuInput.value.trim();
                if (!text) return;

                danmakuInput.value = ''; // 清空输入框
                danmakuRecordsError.textContent = ''; // 清除之前的错误信息

                // 获取 IP 信息
                const location = await getIpInfo();
                const timestamp = new Date().toISOString(); // ISO格式时间戳

                const newDanmaku = { text, location, timestamp };

                // 1. 从 JSONBin 读取现有数据
                try {
                    const response = await fetch(JSONBIN_URL + '/latest', {
                        headers: {
                            'X-Master-Key': JSONBIN_API_KEY,
                            'X-Bin-Meta': 'false'
                        }
                    });
                    let currentRecords = [];
                    if (response.ok) {
                        currentRecords = await response.json();
                    } else if (response.status === 404) { // Bin might be empty/new
                        currentRecords = [];
                    } else {
                        throw new Error(`Failed to read current records: ${response.statusText}`);
                    }

                    // 2. 追加新弹幕到内存中的数组
                    currentRecords.push(newDanmaku);

                    // 3. 更新 JSONBin (PUT操作会覆盖整个bin)
                    const updateResponse = await fetch(JSONBIN_URL, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': JSONBIN_API_KEY
                        },
                        body: JSON.stringify(currentRecords)
                    });

                    if (!updateResponse.ok) {
                        throw new Error(`Failed to update danmaku records: ${updateResponse.statusText}`);
                    }
                    // console.log("Danmaku saved successfully!");
                    
                    // 4. 将新弹幕添加到弹幕池中，使其可以立即滚动
                    danmakuPool.push(newDanmaku);
                    
                    // 5. 刷新历史记录显示
                    fetchDanmakuRecords();

                } catch (error) {
                    console.error("Error saving danmaku:", error);
                    danmakuRecordsError.textContent = `保存弹幕失败: ${error.message}`;
                }

                // Remove danmaku after animation completes
                setTimeout(() => {
                    // 注意：这里的 danmakuItem 和 duration 需要从 sendDanmaku 外面传递进来
                    // 否则 setTimeout 内部无法访问。
                    // 简单起见，这里先移除所有动画中的弹幕，或者调整 startDanmakuLoop 逻辑。
                    // 为了让新弹幕立即在“实时弹幕”区出现，可以直接创建一个 danmakuItem
                    // 并在发送成功后立即添加到danmakuContainer，并开始动画
                    // 这里由于 startDanmakuLoop 每秒随机抽取弹幕池的，
                    // 刚发送的弹幕会被立即添加到 danmakuPool，所以很快就能被抽取并滚动。
                    // 故此处不需要额外的手动添加弹幕item到实时弹幕区。
                }, 0);
            }

            if (danmakuSendButton && danmakuInput && danmakuContainer && danmakuRecordsContainer) {
                fetchDanmakuRecords(); // Initial load of danmaku records
                danmakuSendButton.addEventListener('click', sendDanmaku);
                danmakuInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendDanmaku();
                    }
                });
            } else {
                console.error("Danmaku UI elements not found.");
            }
        });
    </script>
</body>
</html>
